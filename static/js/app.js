!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var i="org.transcrypt.__runtime__",r={};r.interpreter_name="python",r.transpiler_name="transcrypt",r.executor_name=r.transpiler_name,r.transpiler_version="3.7.16";function a(e,t,n){return e&&(e.hasOwnProperty("__class__")||"string"==typeof e||e instanceof String)?(n&&Object.defineProperty(e,n,{value:function(){var n=[].slice.apply(arguments);return t.apply(null,[e].concat(n))},writable:!0,enumerable:!0,configurable:!0}),function(){var n=[].slice.apply(arguments);return t.apply(null,[e].concat(n))}):t}var o={__name__:"type",__bases__:[],__new__:function(e,t,n,i){for(var r=function(){var e=[].slice.apply(arguments);return r.__new__(e)},a=n.length-1;a>=0;a--){var o=n[a];for(var s in o){var l=Object.getOwnPropertyDescriptor(o,s);Object.defineProperty(r,s,l)}for(let e of Object.getOwnPropertySymbols(o)){let t=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(r,e,t)}}for(var s in r.__metaclass__=e,r.__name__=t.startsWith("py_")?t.slice(3):t,r.__bases__=n,i){l=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(r,s,l)}for(let e of Object.getOwnPropertySymbols(i)){let t=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(r,e,t)}return r}};o.__metaclass__=o;var s={__init__:function(e){},__metaclass__:o,__name__:"object",__bases__:[],__new__:function(e){var t=Object.create(this,{__class__:{value:this,enumerable:!0}});return("__getattr__"in this||"__setattr__"in this)&&(t=new Proxy(t,{get:function(e,t){let n=e[t];return null==n?e.__getattr__(t):n},set:function(e,t,n){try{e.__setattr__(t,n)}catch(i){e[t]=n}return!0}})),this.__init__.apply(null,[t].concat(e)),t}};function l(e,t,n,i){return void 0===i&&(i=t[0].__metaclass__),i.__new__(i,e,t,n)}r.executor_name=r.transpiler_name;function c(e){return e.__kwargtrans__=null,e.constructor=Object,e}function u(e,t){for(let n of e.__bases__)if(t in n)return n[t];throw new $("Superclass method not found")}function d(e,t,n){e.hasOwnProperty(t)||Object.defineProperty(e,t,n)}function f(e,t){return null!=t&&(t.__contains__ instanceof Function?t.__contains__(e):t.indexOf?t.indexOf(e)>-1:t.hasOwnProperty(e))}function p(e){return e.startswith("__")&&e.endswith("__")||"constructor"==e||e.startswith("py_")}function h(e){if(null==e)return 0;if(e.__len__ instanceof Function)return e.__len__();if(void 0!==e.length)return e.length;var t=0;for(var n in e)p(n)||t++;return t}function g(e){if("inf"==e)return 1/0;if("-inf"==e)return-1/0;if("nan"==e)return NaN;if(isNaN(parseFloat(e))){if(!1===e)return 0;if(!0===e)return 1;throw J("could not convert string to float: '"+C(e)+"'",new Error)}return+e}function _(e){return 0|g(e)}function m(e){return!(null==(t=e)||!(["boolean","number"].indexOf(typeof t)>=0?t:t.__bool__ instanceof Function?t.__bool__()&&t:t.__len__ instanceof Function?0!==t.__len__()&&t:t instanceof Function?t:0!==h(t)&&t));var t}function v(e){var t=typeof e;if("object"!=t)return"boolean"==t?m:"string"==t?C:"number"==t?e%1==0?_:g:null;try{return"__class__"in e?e.__class__:s}catch(e){return t}}function b(e,t){if(t instanceof Array){for(let n of t)if(b(e,n))return!0;return!1}try{var n=e;if(n==t)return!0;for(var i=[].slice.call(n.__bases__);i.length;){if((n=i.shift())==t)return!0;n.__bases__.length&&(i=[].slice.call(n.__bases__).concat(i))}return!1}catch(n){return e==t||t==s}}function y(e,t){try{return b("__class__"in e?e.__class__:v(e),t)}catch(n){return b(v(e),t)}}function k(e){try{return e.__repr__()}catch(a){try{return e.__str__()}catch(a){try{if(null==e)return"None";if(e.constructor==Object){var t="{",n=!1;for(var i in e)if(!p(i)){if(i.isnumeric())var r=i;else r="'"+i+"'";n?t+=", ":n=!0,t+=r+": "+k(e[i])}return t+="}"}return"boolean"==typeof e?e.toString().capitalize():e.toString()}catch(t){return"<object of type: "+typeof e+">"}}}}function w(e){return 1==arguments.length?Math.max(...e):Math.max(...arguments)}function x(e){return 1==arguments.length?Math.min(...e):Math.min(...arguments)}g.__name__="float",g.__bases__=[s],_.__name__="int",_.__bases__=[s],m.__name__="bool",m.__bases__=[_];var z=Math.abs;function P(e){this.iterable=e,this.index=0}function q(e){this.iterable=e,this.index=0}function S(e){if(null==e||"object"==typeof e)return e;var t={};for(var n in obj)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function O(e){return e?Array.from(e):[]}function T(e){let t=e?[].slice.apply(e):[];return t.__class__=T,t}function A(e){let t=[];if(e)for(let n=0;n<e.length;n++)t.add(e[n]);return t.__class__=A,t}P.prototype.__next__=function(){if(this.index<this.iterable.length)return this.iterable[this.index++];throw Q(new Error)},q.prototype.next=function(){return this.index<this.iterable.py_keys.length?{value:this.index++,done:!1}:{value:void 0,done:!0}},Array.prototype.__class__=O,O.__name__="list",O.__bases__=[s],Array.prototype.__iter__=function(){return new P(this)},Array.prototype.__getslice__=function(e,t,n){if(e<0&&(e=this.length+e),null==t?t=this.length:t<0?t=this.length+t:t>this.length&&(t=this.length),1==n)return Array.prototype.slice.call(this,e,t);let i=O([]);for(let r=e;r<t;r+=n)i.push(this[r]);return i},Array.prototype.__setslice__=function(e,t,n,i){if(e<0&&(e=this.length+e),null==t?t=this.length:t<0&&(t=this.length+t),null==n)Array.prototype.splice.apply(this,[e,t-e].concat(i));else{let r=0;for(let a=e;a<t;a+=n)this[a]=i[r++]}},Array.prototype.__repr__=function(){if(this.__class__==A&&!this.length)return"set()";let e=this.__class__&&this.__class__!=O?this.__class__==T?"(":"{":"[";for(let t=0;t<this.length;t++)t&&(e+=", "),e+=k(this[t]);return this.__class__==T&&1==this.length&&(e+=","),e+=this.__class__&&this.__class__!=O?this.__class__==T?")":"}":"]"},Array.prototype.__str__=Array.prototype.__repr__,Array.prototype.append=function(e){this.push(e)},Array.prototype.py_clear=function(){this.length=0},Array.prototype.extend=function(e){this.push.apply(this,e)},Array.prototype.insert=function(e,t){this.splice(e,0,t)},Array.prototype.remove=function(e){let t=this.indexOf(e);if(-1==t)throw J("list.remove(x): x not in list",new Error);this.splice(t,1)},Array.prototype.index=function(e){return this.indexOf(e)},Array.prototype.py_pop=function(e){return null==e?this.pop():this.splice(e,1)[0]},Array.prototype.py_sort=function(){Z.apply(null,[this].concat([].slice.apply(arguments)))},Array.prototype.__add__=function(e){return O(this.concat(e))},Array.prototype.__mul__=function(e){let t=this;for(let n=1;n<e;n++)t=t.concat(this);return t},Array.prototype.__rmul__=Array.prototype.__mul__,T.__name__="tuple",T.__bases__=[s],A.__name__="set",A.__bases__=[s],Array.prototype.__bindexOf__=function(e){e+="";let t=0,n=this.length-1;for(;t<=n;){let i=(t+n)/2|0,r=this[i]+"";if(r<e)t=i+1;else{if(!(r>e))return i;n=i-1}}return-1},Array.prototype.add=function(e){-1==this.indexOf(e)&&this.push(e)},Array.prototype.discard=function(e){var t=this.indexOf(e);-1!=t&&this.splice(t,1)},Array.prototype.isdisjoint=function(e){this.sort();for(let t=0;t<e.length;t++)if(-1!=this.__bindexOf__(e[t]))return!1;return!0},Array.prototype.issuperset=function(e){this.sort();for(let t=0;t<e.length;t++)if(-1==this.__bindexOf__(e[t]))return!1;return!0},Array.prototype.issubset=function(e){return A(e.slice()).issuperset(this)},Array.prototype.union=function(e){let t=A(this.slice().sort());for(let n=0;n<e.length;n++)-1==t.__bindexOf__(e[n])&&t.push(e[n]);return t},Array.prototype.intersection=function(e){this.sort();let t=A();for(let n=0;n<e.length;n++)-1!=this.__bindexOf__(e[n])&&t.push(e[n]);return t},Array.prototype.difference=function(e){let t=A(e.slice().sort()),n=A();for(let e=0;e<this.length;e++)-1==t.__bindexOf__(this[e])&&n.push(this[e]);return n},Array.prototype.symmetric_difference=function(e){return this.union(e).difference(this.intersection(e))},Array.prototype.py_update=function(){let e=[].concat.apply(this.slice(),arguments).sort();this.py_clear();for(let t=0;t<e.length;t++)e[t]!=e[t-1]&&this.push(e[t])},Array.prototype.__eq__=function(e){if(this.length!=e.length)return!1;this.__class__==A&&(this.sort(),e.sort());for(let t=0;t<this.length;t++)if(this[t]!=e[t])return!1;return!0},Array.prototype.__ne__=function(e){return!this.__eq__(e)},Array.prototype.__le__=function(e){if(this.__class__==A)return this.issubset(e);for(let t=0;t<this.length;t++){if(this[t]>e[t])return!1;if(this[t]<e[t])return!0}return!0},Array.prototype.__ge__=function(e){if(this.__class__==A)return this.issuperset(e);for(let t=0;t<this.length;t++){if(this[t]<e[t])return!1;if(this[t]>e[t])return!0}return!0},Array.prototype.__lt__=function(e){return this.__class__==A?this.issubset(e)&&!this.issuperset(e):!this.__ge__(e)},Array.prototype.__gt__=function(e){return this.__class__==A?this.issuperset(e)&&!this.issubset(e):!this.__le__(e)};function C(e){if("number"==typeof e)return e.toString();try{return e.__str__()}catch(t){try{return k(e)}catch(t){return String(e)}}}function E(e){return this.hasOwnProperty(e)}function I(){var e=[];for(var t in this)p(t)||e.push(t);return e}function R(){var e=[];for(var t in this)p(t)||e.push([t,this[t]]);return e}function j(e){delete this[e]}function L(){for(var e in this)delete this[e]}function D(e,t){var n=this[e];return null==n&&(n=this["py_"+e]),null==n?null==t?null:t:n}function N(e,t){var n=this[e];if(null!=n)return n;var i=null==t?null:t;return this[e]=i,i}function U(e,t){var n=this[e];if(null!=n)return delete this[e],n;if(void 0===t)throw Y(e,new Error);return t}function B(){var e=Object.keys(this)[0];if(null==e)throw Y("popitem(): dictionary is empty",new Error);var t=T([e,this[e]]);return delete this[e],t}function H(e){for(var t in e)this[t]=e[t]}function F(){var e=[];for(var t in this)p(t)||e.push(this[t]);return e}function W(e){return this[e]}function M(e,t){this[e]=t}function G(e){var t={};if(!e||e instanceof Array){if(e)for(var n=0;n<e.length;n++){var i=e[n];if(!(i instanceof Array)||2!=i.length)throw J("dict update sequence element #"+n+" has length "+i.length+"; 2 is required",new Error);var r=i[0],a=i[1];!(e instanceof Array)&&e instanceof Object&&(y(e,G)||(a=G(a))),t[r]=a}}else if(y(e,G)){var o=e.py_keys();for(n=0;n<o.length;n++){t[r=o[n]]=e[r]}}else{if(!(e instanceof Object))throw J("Invalid type of object for dict creation",new Error);t=e}return d(t,"__class__",{value:G,enumerable:!1,writable:!0}),d(t,"__contains__",{value:E,enumerable:!1}),d(t,"py_keys",{value:I,enumerable:!1}),d(t,"__iter__",{value:function(){new P(this.py_keys())},enumerable:!1}),d(t,Symbol.iterator,{value:function(){new q(this.py_keys())},enumerable:!1}),d(t,"py_items",{value:R,enumerable:!1}),d(t,"py_del",{value:j,enumerable:!1}),d(t,"py_clear",{value:L,enumerable:!1}),d(t,"py_get",{value:D,enumerable:!1}),d(t,"py_setdefault",{value:N,enumerable:!1}),d(t,"py_pop",{value:U,enumerable:!1}),d(t,"py_popitem",{value:B,enumerable:!1}),d(t,"py_update",{value:H,enumerable:!1}),d(t,"py_values",{value:F,enumerable:!1}),d(t,"__getitem__",{value:W,enumerable:!1}),d(t,"__setitem__",{value:M,enumerable:!1}),t}function K(e,t){return"object"==typeof e&&"__mod__"in e?e.__mod__(t):"object"==typeof t&&"__rmod__"in t?t.__rmod__(e):(e%t+t)%t}Uint8Array.prototype.__add__=function(e){let t=new Uint8Array(this.length+e.length);return t.set(this),t.set(e,this.length),t},Uint8Array.prototype.__mul__=function(e){let t=new Uint8Array(e*this.length);for(let n=0;n<e;n++)t.set(this,n*this.length);return t},Uint8Array.prototype.__rmul__=Uint8Array.prototype.__mul__,String.prototype.__class__=C,C.__name__="str",C.__bases__=[s],String.prototype.__iter__=function(){new P(this)},String.prototype.__repr__=function(){return(-1==this.indexOf("'")?"'"+this+"'":'"'+this+'"').py_replace("\t","\\t").py_replace("\n","\\n")},String.prototype.__str__=function(){return this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.endswith=function(e){if(!(e instanceof Array))return""==e||this.slice(-e.length)==e;for(var t=0;t<e.length;t++)if(this.slice(-e[t].length)==e[t])return!0;return!1},String.prototype.find=function(e,t){return this.indexOf(e,t)},String.prototype.__getslice__=function(e,t,n){e<0&&(e=this.length+e),null==t?t=this.length:t<0&&(t=this.length+t);var i="";if(1==n)i=this.substring(e,t);else for(var r=e;r<t;r+=n)i=i.concat(this.charAt(r));return i},d(String.prototype,"format",{get:function(){return a(this,function(e){var t=T([].slice.apply(arguments).slice(1)),n=0;return e.replace(/\{(\w*)\}/g,function(e,i){if(""==i&&(i=n++),i==+i)return void 0===t[i]?e:C(t[i]);for(var r=0;r<t.length;r++)if("object"==typeof t[r]&&void 0!==t[r][i])return C(t[r][i]);return e})})},enumerable:!0}),String.prototype.isalnum=function(){return/^[0-9a-zA-Z]{1,}$/.test(this)},String.prototype.isalpha=function(){return/^[a-zA-Z]{1,}$/.test(this)},String.prototype.isdecimal=function(){return/^[0-9]{1,}$/.test(this)},String.prototype.isdigit=function(){return this.isdecimal()},String.prototype.islower=function(){return/^[a-z]{1,}$/.test(this)},String.prototype.isupper=function(){return/^[A-Z]{1,}$/.test(this)},String.prototype.isspace=function(){return/^[\s]{1,}$/.test(this)},String.prototype.isnumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)},String.prototype.join=function(e){return(e=Array.from(e)).join(this)},String.prototype.lower=function(){return this.toLowerCase()},String.prototype.py_replace=function(e,t,n){return this.split(e,n).join(t)},String.prototype.lstrip=function(){return this.replace(/^\s*/g,"")},String.prototype.rfind=function(e,t){return this.lastIndexOf(e,t)},String.prototype.rsplit=function(e,t){if(null==e||null==e){e=/\s+/;var n=this.strip()}else n=this;if(null==t||-1==t)return n.split(e);var i=n.split(e);if(t<i.length){var r=i.length-t;return[i.slice(0,r).join(e)].concat(i.slice(r))}return i},String.prototype.rstrip=function(){return this.replace(/\s*$/g,"")},String.prototype.py_split=function(e,t){if(null==e||null==e){e=/\s+/;var n=this.strip()}else n=this;if(null==t||-1==t)return n.split(e);var i=n.split(e);return t<i.length?i.slice(0,t).concat([i.slice(t).join(e)]):i},String.prototype.startswith=function(e){if(!(e instanceof Array))return 0==this.indexOf(e);for(var t=0;t<e.length;t++)if(0==this.indexOf(e[t]))return!0;return!1},String.prototype.strip=function(){return this.trim()},String.prototype.upper=function(){return this.toUpperCase()},String.prototype.__mul__=function(e){for(var t="",n=0;n<e;n++)t+=this;return t},String.prototype.__rmul__=String.prototype.__mul__,G.__name__="dict",G.__bases__=[s],d(Function.prototype,"__setdoc__",{value:function(e){return this.__doc__=e,this},enumerable:!1});var V=l("BaseException",[s],{__module__:i}),$=l("Exception",[V],{__module__:i,get __init__(){return a(this,function(e){var t=G();if(arguments.length){var n=arguments.length-1;if(arguments[n]&&arguments[n].hasOwnProperty("__kwargtrans__")){var i=arguments[n--];for(var r in i)switch(r){case"self":e=i[r];break;default:t[r]=i[r]}delete t.__kwargtrans__}var a=T([].slice.apply(arguments).slice(1,n+1))}else a=T();e.__args__=a;try{e.stack=t.error.stack}catch(t){e.stack="No stack trace available"}})},get __repr__(){return a(this,function(e){return h(e.__args__)>1?"{}{}".format(e.__class__.__name__,k(T(e.__args__))):h(e.__args__)?"{}({})".format(e.__class__.__name__,k(e.__args__[0])):"{}()".format(e.__class__.__name__)})},get __str__(){return a(this,function(e){return h(e.__args__)>1?C(T(e.__args__)):h(e.__args__)?C(e.__args__[0]):""})}}),Q=(l("IterableError",[$],{__module__:i,get __init__(){return a(this,function(e,t){$.__init__(e,"Can't iterate over non-iterable",c({error:t}))})}}),l("StopIteration",[$],{__module__:i,get __init__(){return a(this,function(e,t){$.__init__(e,"Iterator exhausted",c({error:t}))})}})),J=l("ValueError",[$],{__module__:i,get __init__(){return a(this,function(e,t,n){$.__init__(e,t,c({error:n}))})}}),Y=l("KeyError",[$],{__module__:i,get __init__(){return a(this,function(e,t,n){$.__init__(e,t,c({error:n}))})}}),X=(l("AssertionError",[$],{__module__:i,get __init__(){return a(this,function(e,t,n){t?$.__init__(e,t,c({error:n})):$.__init__(e,c({error:n}))})}}),l("NotImplementedError",[$],{__module__:i,get __init__(){return a(this,function(e,t,n){$.__init__(e,t,c({error:n}))})}}),l("IndexError",[$],{__module__:i,get __init__(){return a(this,function(e,t,n){$.__init__(e,t,c({error:n}))})}}),l("AttributeError",[$],{__module__:i,get __init__(){return a(this,function(e,t,n){$.__init__(e,t,c({error:n}))})}}),l("py_TypeError",[$],{__module__:i,get __init__(){return a(this,function(e,t,n){$.__init__(e,t,c({error:n}))})}}),l("Warning",[$],{__module__:i})),Z=(l("UserWarning",[X],{__module__:i}),l("DeprecationWarning",[X],{__module__:i}),l("RuntimeWarning",[X],{__module__:i}),function(e,t,n){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=!1;if(arguments.length){var i=arguments.length-1;if(arguments[i]&&arguments[i].hasOwnProperty("__kwargtrans__")){var r=arguments[i--];for(var a in r)switch(a){case"iterable":e=r[a];break;case"key":t=r[a];break;case"reverse":n=r[a]}}}t?e.sort(function(e,n){if(arguments.length){var i=arguments.length-1;if(arguments[i]&&arguments[i].hasOwnProperty("__kwargtrans__")){var r=arguments[i--];for(var a in r)switch(a){case"a":e=r[a];break;case"b":n=r[a]}}}return t(e)>t(n)?1:-1}):e.sort(),n&&e.reverse()}),ee=function(e,t,n){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=!1;if(arguments.length){var i=arguments.length-1;if(arguments[i]&&arguments[i].hasOwnProperty("__kwargtrans__")){var r=arguments[i--];for(var a in r)switch(a){case"iterable":e=r[a];break;case"key":t=r[a];break;case"reverse":n=r[a]}}}if(v(e)==G)var o=S(e.py_keys());else o=S(e);return Z(o,t,n),o},te=l("__Terminal__",[s],{__module__:i,get __init__(){return a(this,function(e){e.buffer="";try{e.element=document.getElementById("__terminal__")}catch(t){e.element=null}e.element&&(e.element.style.overflowX="auto",e.element.style.boxSizing="border-box",e.element.style.padding="5px",e.element.innerHTML="_")})},get print(){return a(this,function(e){var t=" ",n="\n";if(arguments.length){var i=arguments.length-1;if(arguments[i]&&arguments[i].hasOwnProperty("__kwargtrans__")){var r=arguments[i--];for(var a in r)switch(a){case"self":e=r[a];break;case"sep":t=r[a];break;case"end":n=r[a]}}var o=T([].slice.apply(arguments).slice(1,i+1))}else o=T();e.buffer="{}{}{}".format(e.buffer,t.join(function(){var e=[];for(var t of o)e.append(C(t));return e}()),n).__getslice__(-4096,null,1),e.element?(e.element.innerHTML=e.buffer.py_replace("\n","<br>").py_replace(" ","&nbsp"),e.element.scrollTop=e.element.scrollHeight):console.log(t.join(function(){var e=[];for(var t of o)e.append(C(t));return e}()))})},get input(){return a(this,function(e,t){if(arguments.length){var n=arguments.length-1;if(arguments[n]&&arguments[n].hasOwnProperty("__kwargtrans__")){var i=arguments[n--];for(var r in i)switch(r){case"self":e=i[r];break;case"question":t=i[r]}}}e.print("{}".format(t),c({end:""}));var a=window.prompt("\n".join(e.buffer.py_split("\n").__getslice__(-8,null,1)));return e.print(a),a})}})(),ne=te.print,ie=(te.input,function(){return f("localhost",window.location.host)?"dev":"prod"}),re=function(){return"dev"==ie()},ae=G({});try{var oe=window.location.search.slice(1).py_split("&");for(var se of oe){var le=se.py_split("=");ae[le[0]]=le[1]}}catch(e){ne("could not parse query string")}ne("queryparams",ae);var ce=1,ue=function(){ce++;var e=1e4*Math.sin(ce);return e-Math.floor(e)},de=function(e){return z(e)<9e3?C(e):"#{}".format(e>=0?1e4-e:-1e4-e)},fe=function(e){return e>9e3?"#0f0":e>1e3?"#0e0":e>500?"#0c0":e>350?"#0a0":e>250?"#090":e>150?"#070":e>80?"#050":e>0?"#033":e>-80?"#330":e>-150?"#500":e>-250?"#900":e>-350?"#a00":e>-500?"#c00":e>1e3?"#e00":"#f00"},pe=function(e,t){try{return _(function(e){return getComputedStyle(window.document.documentElement).getPropertyValue(e)}(e).py_replace("px",""))}catch(e){return t}},he=l("View",[s],{__module__:"utils",get __init__(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=null;e.callback=t,e.value=n})},get py_get(){return a(this,function(e){return e.value})},get set(){return a(this,function(e,t){e.value=t,e.callback()})}}),ge=l("Vect",[s],{__module__:"utils",get __init__(){return a(this,function(e,t,n){try{e.x=g(t),e.y=g(n)}catch(i){e.x=0,e.y=0,ne("vect init failed on",t,n)}})},get p(){return a(this,function(e,t){return ge(e.x+t.x,e.y+t.y)})},get s(){return a(this,function(e,t){return ge(e.x*t,e.y*t)})},get m(){return a(this,function(e,t){return e.p(t.s(-1))})},get copy(){return a(this,function(e){return ge(e.x,e.y)})},get __repr__(){return a(this,function(e){return"Vect[x: {}, y: {}]".format(e.x,e.y)})}}),_e=function(e,t){return(!e||!t)&&!(!e&&!t)},me=function(e,t){for(var n="{}".format(e);h(n)<t;)n="0"+n;return n},ve=function(e,t){try{var n=g(e)}catch(e){n=t}return null==n?t:n},be=function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=[];for(var n=e.firstChild;void 0!==n&&n;){t.append(n);t=be(n,t),n=n.nextSibling}return t},ye=function(e){return e.py_replace("&","&amp;").py_replace("<","&lt;").py_replace(">","&gt;").py_replace("\n","<br>")},ke=function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=null;var i=e.py_split("/"),r=i[0];if("dict"==t.disposition)for(var a of t.childsarg)if(a.key==r)return 1==h(i)?a.value:ke("/".join(i.__getslice__(1,null,1)),a,n);return n},we=function(e,t,n){var i=ke(e,t,"__none__");return"__none__"===i?ke(function(e){return e+":"+ie()}(e),t,n):i},xe=function(e,t,n){return f(t,e)?e[t]:n},ze=function(e,t,n){return e?t:n},Pe=function(e,t){return e||t},qe=function(e){return document.getElementById(e)},Se=l("e",[s],{__module__:"dom",get __init__(){return a(this,function(e,t){e.e=function(e){return document.createElement(e)}(t)})},get ta(){return a(this,function(e,t){return e.e.style.textAlign=t,e})},get disp(){return a(this,function(e,t){return e.e.style.display=t,e})},get fd(){return a(this,function(e,t){return e.e.style.flexDirection=t,e})},get jc(){return a(this,function(e,t){return e.e.style.justifyContent=t,e})},get bc(){return a(this,function(e,t){return e.e.style.backgroundColor=t,e})},get bds(){return a(this,function(e,t){return e.e.style.borderStyle=t,e})},get bdw(){return a(this,function(e,t){return e.e.style.borderWidth=t+"px",e})},get bdr(){return a(this,function(e,t){return e.e.style.borderRadius=t+"px",e})},get bdc(){return a(this,function(e,t){return e.e.style.borderColor=t,e})},get curlyborder(){return a(this,function(e){return e.bds("solid").bdw(1).bdc("#777").bdr(20)})},get bci(){return a(this,function(e,t){return e.e.style.backgroundImage="url({})".format(t),e})},get cp(){return a(this,function(e){return e.e.style.cursor="pointer",e})},get cm(){return a(this,function(e){return e.e.style.cursor="move",e})},get c(){return a(this,function(e,t){return e.e.style.color=t,e})},get zi(){return a(this,function(e,t){return e.e.style.zIndex=t,e})},get op(){return a(this,function(e,t){return e.e.style.opacity=t,e})},get ms(){return a(this,function(e){return e.e.style.fontFamily="monospace",e})},get a(){return a(this,function(e,t){if(Array.isArray(t))for(var n of t)e.e.appendChild(n.e);else e.e.appendChild(t.e);return e})},get ai(){return a(this,function(e,t){return e.e.style.alignItems=t,e})},get sa(){return a(this,function(e,t,n){return e.e.setAttribute(t,n),e})},get ra(){return a(this,function(e,t){return e.e.removeAttribute(t),e})},get srac(){return a(this,function(e,t,n,i){t?e.sa(n,i):e.ra(n)})},get ga(){return a(this,function(e,t){return e.e.getAttribute(t)})},get sv(){return a(this,function(e,t){return e.e.value=t,e})},get html(){return a(this,function(e,t){return e.e.innerHTML=t,e})},get x(){return a(this,function(e){for(;e.e.firstChild;)e.e.removeChild(e.e.firstChild);return e})},get w(){return a(this,function(e,t){return e.e.style.width=t+"px",e})},get mw(){return a(this,function(e,t){return e.e.style.minWidth=t+"px",e})},get maw(){return a(this,function(e,t){return e.e.style.maxWidth=t+"px",e})},get h(){return a(this,function(e,t){return e.e.style.height=t+"px",e})},get mh(){return a(this,function(e,t){return e.e.style.minHeight=t+"px",e})},get mah(){return a(this,function(e,t){return e.e.style.maxHeight=t+"px",e})},get t(){return a(this,function(e,t){return e.e.style.top=t+"px",e})},get l(){return a(this,function(e,t){return e.e.style.left=t+"px",e})},get pv(){return a(this,function(e,t){return e.l(t.x).t(t.y)})},get pa(){return a(this,function(e){return e.e.style.position="absolute",e})},get pr(){return a(this,function(e){return e.e.style.position="relative",e})},get mar(){return a(this,function(e,t){return e.e.style.margin=t+"px",e})},get pad(){return a(this,function(e,t){return e.e.style.padding=t+"px",e})},get ml(){return a(this,function(e,t){return e.e.style.marginLeft=t+"px",e})},get mr(){return a(this,function(e,t){return e.e.style.marginRight=t+"px",e})},get mt(){return a(this,function(e,t){return e.e.style.marginTop=t+"px",e})},get mb(){return a(this,function(e,t){return e.e.style.marginBottom=t+"px",e})},get pl(){return a(this,function(e,t){return e.e.style.paddingLeft=t+"px",e})},get par(){return a(this,function(e,t){return e.e.style.paddingRight=t+"px",e})},get pt(){return a(this,function(e,t){return e.e.style.paddingTop=t+"px",e})},get pb(){return a(this,function(e,t){return e.e.style.paddingBottom=t+"px",e})},get ac(){return a(this,function(e,t){if(Array.isArray(t))for(var n of t)e.e.classList.add(n);else e.e.classList.add(t);return e})},get acc(){return a(this,function(e,t,n){return t&&e.e.classList.add(n),e})},get rc(){return a(this,function(e,t){if(Array.isArray(t))for(var n of t)e.e.classList.remove(n);else e.e.classList.remove(t);return e})},get arc(){return a(this,function(e,t,n){return t?e.e.classList.add(n):e.e.classList.remove(n),e})},get v(){return a(this,function(e){return e.e.value})},get focusme(){return a(this,function(e){return e.e.focus(),e})},get fl(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=50;return setTimeout(e.focusme,t),e})},get ae(){return a(this,function(e,t,n,i){if(void 0===i||null!=i&&i.hasOwnProperty("__kwargtrans__"))i=!1;if(Array.isArray(t))for(var r of t)e.e.addEventListener(r,n,i);else e.e.addEventListener(t,n,i);return e})},get disable(){return a(this,function(e){return e.sa("disabled",!0)})},get enable(){return a(this,function(e){return e.ra("disabled")})},get able(){return a(this,function(e,t){return t?e.enable():e.disable()})},get fs(){return a(this,function(e,t){return e.e.style.fontSize=t+"px",e})},get fst(){return a(this,function(e,t){return e.e.style.fontStyle=t,e})},get ff(){return a(this,function(e,t){return e.e.style.fontFamily=t,e})},get fw(){return a(this,function(e,t){return e.e.style.fontWeight=t,e})}}),Oe=l("Div",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;u(Oe,"__init__")(e,"div"),t&&e.ac(t)})}}),Te=l("Span",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;u(Te,"__init__")(e,"span"),t&&e.ac(t)})}}),Ae=l("Br",[Se],{__module__:"dom",get __init__(){return a(this,function(e){u(Ae,"__init__")(e,"br")})}}),Ce=l("Table",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;u(Ce,"__init__")(e,"table"),t&&e.ac(t)})}}),Ee=l("Tr",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;u(Ee,"__init__")(e,"tr"),t&&e.ac(t)})}}),Ie=l("Td",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;u(Ie,"__init__")(e,"td"),t&&e.ac(t)})}}),Re=l("Input",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t){u(Re,"__init__")(e,"input"),e.sa("type",t)})}}),je=l("Button",[Re],{__module__:"dom",get __init__(){return a(this,function(e,t,n){u(je,"__init__")(e,"button"),e.sa("value",t),e.ae("mousedown",n),e.ac("button")})}}),Le=l("Select",[Se],{__module__:"dom",get __init__(){return a(this,function(e){u(Le,"__init__")(e,"select")})}}),De=l("Option",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t,n,i){if(void 0===i||null!=i&&i.hasOwnProperty("__kwargtrans__"))i=!1;u(De,"__init__")(e,"option"),e.sa("name",t),e.sa("id",t),e.sv(t),e.html(n),i&&e.sa("selected",!0)})}}),Ne=l("ComboBox",[Se],{__module__:"dom",get changed(){return a(this,function(e){e.changecallback&&e.changecallback(e.v())})},get __init__(){return a(this,function(e){u(Ne,"__init__")(e,"select"),e.ae("change",e.changed)})},get setoptions(){return a(this,function(e,t,n,i){for(var r of(e.changecallback=i,e.x(),t))e.a(De(r[0],r[1],r[0]==n));return e})}}),Ue=l("Slider",[Re],{__module__:"dom",get setmin(){return a(this,function(e,t){return e.sa("min",t),e})},get setmax(){return a(this,function(e,t){return e.sa("max",t),e})},get setstep(){return a(this,function(e,t){return e.sa("step",t),e})},get __init__(){return a(this,function(e){u(Ue,"__init__")(e,"range")})}}),Be=l("CheckBox",[Re],{__module__:"dom",get setchecked(){return a(this,function(e,t){return e.e.checked=t,e})},get getchecked(){return a(this,function(e){return e.e.checked})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=!1;u(Be,"__init__")(e,"checkbox"),e.setchecked(t)})}}),He=l("Radio",[Re],{__module__:"dom",get setchecked(){return a(this,function(e,t){return e.e.checked=t,e})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=!1;u(He,"__init__")(e,"radio"),e.setchecked(t)})}}),Fe=l("DateInput",[Re],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=!1;u(Fe,"__init__")(e,"date")})}}),We=l("ColorInput",[Re],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=!1;u(We,"__init__")(e,"color")})}}),Me=l("TextInput",[Re],{__module__:"dom",get onchange(){return a(this,function(e){e.rc("textinputediting"),e.changecallback&&e.changecallback()})},get onenter(){return a(this,function(e){e.entercallback&&e.entercallback()})},get onkeyup(){return a(this,function(e,t){e.ac("textinputediting"),e.keyupcallback?e.keyupcallback(e.ev.keyCode):13==t.keyCode?(e.onchange(),e.onenter()):e.editingcallback&&e.editingcallback()})},get setchangecallback(){return a(this,function(e,t){return e.changecallback=t,e})},get setentercallback(){return a(this,function(e,t){return e.entercallback=t,e})},get setkeyupcallback(){return a(this,function(e,t){return e.keyupcallback=t,e})},get seteditingcallback(){return a(this,function(e,t){return e.editingcallback=t,e})},get __init__(){return a(this,function(e){u(Me,"__init__")(e,"text"),e.ac("textinput"),e.changecallback=null,e.keyupcallback=null,e.ae("change",e.onchange),e.ae("keyup",e.onkeyup)})},get setText(){return a(this,function(e,t){return e.sv(t),e})},get getText(){return a(this,function(e){return e.v()})}}),Ge=l("PasswordInput",[Re],{__module__:"dom",get __init__(){return a(this,function(e){u(Ge,"__init__")(e,"password")})},get setText(){return a(this,function(e,t){return e.sv(t),e})},get getText(){return a(this,function(e){return e.v()})}}),Ke=l("TextArea",[Se],{__module__:"dom",get insert(){return a(this,function(e,t){var n=e.e.selectionStart,i=e.e.selectionEnd,r=e.v(),a=r.substring(0,n)+t+r.substring(i);e.sv(a),e.e.selectionEnd=n+h(t)})},get keydowncallback(){return a(this,function(e,t){if(9==t.keyCode)t.preventDefault(),e.insert("\t");else if(13==t.keyCode){t.preventDefault();var n=e.v().substring(0,e.e.selectionStart).py_split("\n"),i=n[h(n)-1].py_split(""),r="";for(var a of i){if("\t"!=a)break;r+="\t"}e.insert("\n"+r)}})},get __init__(){return a(this,function(e){u(Ke,"__init__")(e,"textarea"),e.ae("keydown",e.keydowncallback)})},get setText(){return a(this,function(e,t){return e.sv(t),e})},get getText(){return a(this,function(e){return e.v()})}}),Ve=l("Canvas",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t,n){u(Ve,"__init__")(e,"canvas"),e.width=t,e.height=n,e.sa("width",e.width),e.sa("height",e.height),e.ctx=e.e.getContext("2d")})},get lineWidth(){return a(this,function(e,t){e.ctx.lineWidth=t})},get strokeStyle(){return a(this,function(e,t){e.ctx.strokeStyle=t})},get fillStyle(){return a(this,function(e,t){e.ctx.fillStyle=t})},get fillRect(){return a(this,function(e,t,n){e.ctx.fillRect(t.x,t.y,n.m(t).x,n.m(t).y)})},get py_clear(){return a(this,function(e){e.ctx.clearRect(0,0,e.width,e.height)})},get drawline(){return a(this,function(e,t,n){e.ctx.beginPath(),e.ctx.moveTo(t.x,t.y),e.ctx.lineTo(n.x,n.y),e.ctx.stroke()})}}),$e=l("Form",[Se],{__module__:"dom",get __init__(){return a(this,function(e){u($e,"__init__")(e,"form")})}}),Qe=l("P",[Se],{__module__:"dom",get __init__(){return a(this,function(e){u(Qe,"__init__")(e,"p")})}}),Je=l("Label",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;u(Je,"__init__")(e,"label"),t&&e.html(t)})}}),Ye=l("FileInput",[Re],{__module__:"dom",get setmultiple(){return a(this,function(e,t){return e.srac(t,"multiple",!0),e})},get getmultiple(){return a(this,function(e){return e.ga("multiple")})},get setaccept(){return a(this,function(e,t){return e.sa("accept",t)})},get getaccept(){return a(this,function(e){return e.ga("accept")})},get files(){return a(this,function(e){return e.e.files})},get __init__(){return a(this,function(e){u(Ye,"__init__")(e,"file")})}}),Xe=l("Hlink",[Se],{__module__:"dom",get __init__(){return a(this,function(e,t,n){u(Xe,"__init__")(e,"a"),e.sa("href",t),e.html(n)})}}),Ze=l("SplitPane",[Se],{__module__:"widgets",get resize(){return a(this,function(e,t,n){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=null;null!==t&&(e.width=w(t,e.minwidth)),null!==n&&(e.height=n),e.contentheight=w(e.height-e.controlheight,e.mincontentheight),e.height=e.controlheight+e.contentheight,e.container.w(e.width).h(e.height),e.controlpanel.w(e.width).h(e.controlheight),e.contentdiv.w(e.width).h(e.contentheight);var i=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var i=n.offsetWidth;return e.parentNode.removeChild(e),t-i}();e.contentinnerwidth=e.width-i,e.contentinnerheight=e.contentheight-i,e.contentdiv.x().a(e.contentelement);try{e.contentelement.resize(e.contentinnerwidth,e.contentinnerheight)}catch(e){}return e})},get setcontentelement(){return a(this,function(e,t){return e.contentelement=t,e.resize(e.width,e.height),e})},get resizetowindow(){return a(this,function(e){return e.resize(window.innerWidth,window.innerHeight),e})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(Ze,"__init__")(e,"div"),e.controlheight=t.py_get("controlheight",100),e.container=Oe(["splitpane","container"]),e.controlpanel=Oe(["splitpane","controlpanel"]),e.contentdiv=Oe(["splitpane","contentdiv"]),e.container.a([e.controlpanel,e.contentdiv]),e.contentelement=Oe(),e.minwidth=t.py_get("minwidth",400),e.mincontentheight=t.py_get("mincontentheight",200),e.resize(t.py_get("width",600),t.py_get("height",400)),e.fillwindow=t.py_get("fillwindow",!1),e.fillwindow&&(window.addEventListener("resize",e.resizetowindow),e.resizetowindow()),e.a(e.container)})}}),et=l("Tab",[Se],{__module__:"widgets",get __init__(){return a(this,function(e,t,n,i,r){u(et,"__init__")(e,"div"),e.key=t,e.displayname=n,e.element=i,e.clickedcallback=r,e.container=Oe(["tab","container","noselect"]).html(n),e.a(e.container)})}}),tt=l("TabPane",[Ze],{__module__:"widgets",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});if(t.controlheight=t.py_get("controlheight",35),u(tt,"__init__")(e,t),e.tabmargin=t.py_get("tabmargin",5),e.tabpadding=t.py_get("tabpadding",5),e.tabs=t.py_get("tabs",[]),e.settabs(e.tabs),e.tabheight=e.controlheight-2*(e.tabmargin+e.tabpadding),e.tabfontsize=e.tabheight,e.id=t.py_get("id",null),e.selected=t.py_get("selected",null),e.id){var n=localStorage.getItem(e.id);n&&(e.selected=n)}e.build(),e.contentdiv.ae("scroll",e.contentscrolled)})},get scrollpath(){return a(this,function(e,t){return"tabpanecontentscroll/{}/{}/{}".format(e.id,e.selected,t)})},get contentscrolled(){return a(this,function(e){localStorage.setItem(e.scrollpath("left"),C(e.contentdiv.e.scrollLeft)),localStorage.setItem(e.scrollpath("top"),C(e.contentdiv.e.scrollTop))})},get setscroll(){return a(this,function(e){var t=localStorage.getItem(e.scrollpath("left"));try{e.contentdiv.e.scrollLeft=_(t)}catch(e){}var n=localStorage.getItem(e.scrollpath("top"));try{e.contentdiv.e.scrollTop=_(n)}catch(e){}})},get selectbykey(){return a(this,function(e,t){e.selected=t,e.id&&localStorage.setItem(e.id,e.selected),e.build()})},get tabclickedfactory(){return a(this,function(e,t){return function(){e.selectbykey(t.key),t.clickedcallback&&t.clickedcallback()}})},get settabs(){return a(this,function(e,t){for(var n of(e.tabs=t,e.tabs))n.ae("mousedown",e.tabclickedfactory(n)),n.element.parenttabpane=e;return e})},get build(){return a(this,function(e){for(var t of(e.controlpanel.x(),e.tabs))t.container.h(e.tabheight).pad(e.tabpadding).pl(2*e.tabpadding).par(2*e.tabpadding),e.controlpanel.a(t),t.container.arc(t.key==e.selected,"selected").fs(e.tabfontsize),t.key==e.selected&&e.setcontentelement(t.element);return e.setscroll(),e})}}),nt=l("FileUploader",[Se],{__module__:"widgets",get fileinputchanged(){return a(this,function(e){e.files=e.fileinput.files(),e.handlefiles()})},get preventdefaults(){return a(this,function(e,t){t.preventDefault(),t.stopPropagation()})},get highlight(){return a(this,function(e){e.droparea.ac("highlight")})},get unhighlight(){return a(this,function(e){e.droparea.rc("highlight")})},get log(){return a(this,function(e,t){e.infoitems.append(t),e.infoitems.reverse(),e.info.html("<br>".join(e.infoitems)),e.infoitems.reverse()})},get loginfo(){return a(this,function(e,t){try{var n=JSON.parse(t);if(n.success)if(e.dirbrowseruploadedcallback)e.dirbrowseruploadedcallback(),e.log("Uploaded <span class='fileuploadfilename'>{}</span> .".format(n.filename));else{var i="/uploads/{}".format(n.savefilename);e.log("uploaded <span class='fileuploadfilename'>{}</span> <a href='{}' target='_blank' rel='noopener noreferrer'>{}</a> <br> <font size='2'> media link <a href='{}' target='_blank' rel='noopener noreferrer'>{}</a> </font>".format(n.filename,i,i,n.medialink,n.medialink))}else e.log("<span class='fileuploaderror'>File upload failed. Status: {} .</span>".format(n.status))}catch(t){e.log("Error parsing response as JSON.")}})},get uploadfile(){return a(this,function(e,t){if(null!==e.url){var n=new FormData;n.append("files",t),n.append("drive",e.drive),e.getuid&&n.append("uid",e.getuid()),e.dirbrowsergetpathcallback&&n.append("dirpath",e.dirbrowsergetpathcallback());var i={method:"POST",body:n};fetch(e.url,i).then(function(t){return t.text().then(function(t){return e.loginfo(t)},function(t){return e.loginfo(t)})},function(t){return e.loginfo(t)})}else ne("no upload url")})},get handlefiles(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=e.files;for(var n=0;n<t.length;n++)ne("uploading file {}".format(n)),e.uploadfile(t.item(n))})},get handledrop(){return a(this,function(e,t){e.dt=t.dataTransfer,e.files=e.dt.files,e.handlefiles()})},get build(){return a(this,function(e){for(var t of(e.x(),e.droparea=Oe("fileuploaddroparea"),e.form=$e().ac("fileuploadform"),e.desc=Qe().ac("fileuploadp").html("Upload {}s with the file dialog or by dragging and dropping them onto the dashed region".format(e.acceptdisplay)),e.fileinput=Ye().ac("fileuploadfileelem").setmultiple(e.multiple).setaccept(e.accept),e.fileinput.sa("id","fileinputelement"),e.fileinput.ae("change",e.fileinputchanged),e.button=Je().ac("fileuploadbutton").sa("for","fileinputelement").html("Select some {}s".format(e.acceptdisplay)),e.form.a([e.desc,e.fileinput,e.button]),e.droparea.a(e.form),["dragenter","dragover","dragleave","drop"]))e.droparea.ae(t,e.preventdefaults);for(var t of["dragenter","dragover"])e.droparea.ae(t,e.highlight);for(var t of["dragleave","drop"])e.droparea.ae(t,e.unhighlight);e.droparea.ae("drop",e.handledrop),e.info=Oe("fileuploadinfo"),e.infoitems=[],e.a([e.droparea,e.info])})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(nt,"__init__")(e,"div"),e.url=t.py_get("url",null),e.multiple=t.py_get("multiple",!0),e.accept=t.py_get("accept","image/*"),e.acceptdisplay=t.py_get("acceptdisplay","image"),e.drive=t.py_get("drive",!1),e.dirbrowseruploadedcallback=t.py_get("dirbrowseruploadedcallback",null),e.dirbrowsergetpathcallback=t.py_get("dirbrowsergetpathcallback",null),e.getuid=t.py_get("getuid",null),e.build()})}}),it=l("ProcessInput",[Se],{__module__:"widgets",get onenter(){return a(this,function(e){e.textinput.rc("textinputediting"),e.entercallback&&e.entercallback()})},get getText(){return a(this,function(e){return e.textinput.getText()})},get setText(){return a(this,function(e,t){return e.textinput.setText(t),e})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(it,"__init__")(e,"div"),e.container=Oe("processinput"),e.buttonlabel=t.py_get("buttonlabel","Submit"),e.entercallback=t.py_get("entercallback",null),e.textinput=Me().setentercallback(e.entercallback),e.submitbutton=je(e.buttonlabel,e.onenter),e.container.a([e.textinput,e.submitbutton]),e.a(e.container)})}}),rt=l("LogItem",[Se],{__module__:"widgets",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(rt,"__init__")(e,"div"),e.text=t.py_get("text",""),e.kind=t.py_get("kind","normal"),e.prompt=t.py_get("prompt",null),e.container=Oe("logitem"),e.container.ac(e.kind),e.promptspan=Te().ac("prompt"),e.prompt&&e.promptspan.html(e.prompt),e.textspan=Te().html(ye(e.text)).ac(e.kind),e.container.a([e.promptspan,e.textspan]),e.a(e.container)})}}),at=l("Log",[Se],{__module__:"widgets",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(at,"__init__")(e,"div"),e.py_items=[],e.container=Oe(),e.a(e.container)})},get build(){return a(this,function(e){for(var t of(e.container.x(),e.py_items))e.container.a(t)})},get log(){return a(this,function(e,t){var n=[t],i=1;for(var r of e.py_items){if(!(i<100))break;n.append(r),i++}e.py_items=n,e.build()})}}),ot=l("Connection",[s],{__module__:"connection",get signincallback(){return a(this,function(e){var t=e.emailinput.getText(),n=e.passwordinput.getText();ne("signing in user with",t,n),firebase.auth().signInWithEmailAndPassword(t,n).then(function(){return ne("ok")},function(e){return window.alert("{}".format(e))})})},get signoutcallback(){return a(this,function(e){firebase.auth().currentUser?(ne("signing out"),firebase.auth().signOut()):window.alert("Already signed out.")})},get signupcallback(){return a(this,function(e){var t=e.emailinput.getText(),n=e.passwordinput.getText();ne("signing up user with",t,n),firebase.auth().createUserWithEmailAndPassword(t,n).then(function(){return ne("ok")},function(e){return window.alert("{}".format(e))})})},get sendverificationcallback(){return a(this,function(e){var t=e.emailinput.getText();firebase.auth().currentUser.sendEmailVerification().then(function(){return window.alert("Verification email has been sent to {} !".format(t))},function(e){return window.alert("{}".format(e))})})},get resetpasswordcallback(){return a(this,function(e){var t=e.emailinput.getText();firebase.auth().sendPasswordResetEmail(t).then(function(){return window.alert("Password reset email has been sent to {} !".format(t))},function(e){return window.alert("{}".format(e))})})},get updatedisplaynamecallback(){return a(this,function(e){lt().sioreq(G({kind:"updateuserdisplayname",displayname:e.displaynameinput.getText(),uid:e.uid}))})},get updatephotourlcallback(){return a(this,function(e){lt().sioreq(G({kind:"updateuserphotourl",photourl:e.photourlinput.getText(),uid:e.uid}))})},get linkgoogleok(){return a(this,function(e,t){ne(t),window.alert("Account linked with Google !"),location.reload()})},get linkmailok(){return a(this,function(e,t){ne(t),window.alert("Account linked with Email !"),location.reload()})},get linkgooglecallback(){return a(this,function(e){var t=new firebase.auth.GoogleAuthProvider;firebase.auth().currentUser.linkWithPopup(t).then(e.linkgoogleok,function(e){return window.alert("Link Google failed: {}".format(e))})})},get linkmailcallback(){return a(this,function(e){var t=firebase.auth.EmailAuthProvider.credential(e.emailinput.getText(),e.passwordinput.getText());firebase.auth().currentUser.linkAndRetrieveDataWithCredential(t).then(e.linkmailok,function(e){return window.alert("Link Email failed: {}".format(e))})})},get helpcallback(){return a(this,function(e){e.sioreq(G({kind:"getdoc",data:"profilehelp",owner:"doc"}))})},get buildsignupdiv(){return a(this,function(e){e.signupdiv=Oe(),e.signupmaildiv=Oe("signupmaildiv"),e.emaillabel=Te().html("Email:"),e.emailinput=Me().ac("profiletextinput").w(250),e.passwordlabel=Te().html("Password:"),e.passwordinput=Ge().ac("profiletextinput").w(100),e.helpbutton=je("Help",e.helpcallback).ac("helpbutton"),e.signinbutton=je("Sign in",e.signincallback),e.signoutbutton=je("Sign out",e.signoutcallback),e.signupbutton=je("Sign up",e.signupcallback),e.sendverificationbutton=je("Send verification",e.sendverificationcallback),e.resetpasswordbutton=je("Reset password",e.resetpasswordcallback),e.linkgooglebutton=je("Link Google",e.linkgooglecallback),e.linkmailbutton=je("Link Email",e.linkmailcallback),e.userinfodiv=Oe("userinfodiv"),e.signupmaildiv.a([e.helpbutton,e.emaillabel,e.emailinput,e.passwordlabel,e.passwordinput,e.signinbutton,e.signoutbutton,e.signupbutton,e.sendverificationbutton,e.resetpasswordbutton,e.linkgooglebutton,e.linkmailbutton]),e.userdetailsdiv=Oe("userdetailsdiv"),e.displaynamelabel=Te().html("Display name:"),e.displaynameinput=Me().ac("profiletextinput").w(250),e.photourllabel=Te().html("Photo url:"),e.photourlinput=Me().ac("profiletextinput").w(250),e.updatedisplaynamebutton=je("Update display name",e.updatedisplaynamecallback),e.updatephotourlbutton=je("Update photo url",e.updatephotourlcallback),e.userdetailsdiv.a([e.displaynamelabel,e.displaynameinput,e.updatedisplaynamebutton,e.photourllabel,e.photourlinput,e.updatephotourlbutton]),e.photodiv=Oe("photodiv"),e.signupdiv.a([e.signupmaildiv,e.userdetailsdiv,e.userinfodiv,e.photodiv]),e.firebaseuidiv=Oe().sa("id","firebaseuidiv"),e.signupdiv.a(e.firebaseuidiv)})},get logobj(){return a(this,function(e,t,n,i){var r=JSON.stringify(n);if(e.log){var a=rt(G({text:r,kind:t,prompt:i}));a.container.ac("socketlog"),e.log.log(a)}})},get emit(){return a(this,function(e,t,n){e.logobj("info",n,"-> "),e.rawsocket&&e.rawsocket.emit(t,n)})},get sioreq(){return a(this,function(e,t){t.uid=e.getuid(),e.emit("sioreq",t)})},get onconnect(){return a(this,function(e){e.log&&e.logobj("success","socket connected ok","socket message: "),e.configloaded||e.sioreq(G({kind:"sendfirebaseconfig"})),e.connectcallback&&e.connectcallback()})},get siores(){return a(this,function(e,t){(e.log&&e.logobj("normal",t,"<- "),e.configloaded)?e.siorescallback&&e.siorescallback(t):"firebaseconfig"==t.kind&&(e.configloaded=!0,e.startfirebase(t.firebaseconfig))})},get getuserdisplayname(){return a(this,function(e){return e.user?e.displayName?e.displayName:e.email:null})},get setprofiletab(){return a(this,function(e){e.profiletab.rc(["profilelogged","profileanon"]);var t=e.getuserdisplayname();t?(e.profiletab.container.html(t),e.profiletab.ac("profilelogged")):e.user?(e.profiletab.container.html("Anonymous"),e.profiletab.ac("profileanon")):e.profiletab.container.html("Profile")})},get signinanonymously(){return a(this,function(e){firebase.auth().signInAnonymously().then(function(){return ne("ok")},function(e){return ne(e)})})},get userstatusverbal(){return a(this,function(e){return e.user?e.user.isAnonymous?"anonymous":ze(e.emailVerified,"verified","not verified"):"[logged out]"})},get userverified(){return a(this,function(e){return!!e.user&&(!e.user.isAnonymous&&e.user.emailVerified)})},get authstatechanged(){return a(this,function(e,t){e.user=t,e.passwordinput.setText(""),t?(e.displayName=t.displayName,e.email=t.email,e.emailVerified=t.emailVerified,e.photoURL=t.photoURL,e.isAnonymous=t.isAnonymous,e.uid=t.uid,e.providerData=t.providerData,ne("user:",e.uid,e.displayName,e.email,e.providerData),e.nameinfodiv=Oe().html("name : <span class='{}'>{}</span>".format(ze(e.displayName,"uiinfo","uiinfored"),Pe(e.displayName,"&lt;NA&gt;"))).pt(5),e.emailinfodiv=Oe().html("email : <span class='{}'>{}</span>".format(ze(e.email,"uiinfo","uiinfored"),Pe(e.email,"&lt;NA&gt;"))),e.verifiedinfodiv=Oe().html("status : <span class='{}'>{}</span>".format(ze(e.userverified(),"uiinfo","uiinfored"),e.userstatusverbal())),e.photourldiv=Oe().html("photo url : <span class='{}'>{}</span>".format(ze(e.photoURL,"uiinfo","uiinfored"),Pe(e.photoURL,"&lt;NA&gt;"))),e.uidinfodiv=Oe().html("uid : <span class='uiinfo'>{}</span>".format(e.uid)).pb(8),e.userinfodiv.x().a([e.nameinfodiv,e.emailinfodiv,e.verifiedinfodiv,e.photourldiv,e.uidinfodiv]),e.emailinput.setText(e.email),e.displaynameinput.setText(e.displayName),e.photourlinput.setText(e.photoURL),e.photodiv.x(),e.photoURL&&e.photodiv.html("<img src='{}' class='userphotoimg'></img>".format(e.photoURL))):(ne("no user"),e.userinfodiv.x().a([Oe().html("Please sign up or sign in !"),je("Sign in anonymously",e.signinanonymously())])),e.setprofiletab(),e.userinfodiv.fs(ze(e.user,10,14)),t&&e.authcallback&&e.authcallback()})},get initializefirebase(){return a(this,function(e){ne("initializing firebase from",e.firebaseconfig),firebase.initializeApp(e.firebaseconfig),firebase.auth().onAuthStateChanged(e.authstatechanged)})},get initializefirebaseui(){return a(this,function(e){e.uiConfig=G({signInSuccessUrl:"/",signInOptions:[firebase.auth.GoogleAuthProvider.PROVIDER_ID,firebase.auth.EmailAuthProvider.PROVIDER_ID],tosUrl:"/tos"}),ne("initializing firebase ui from",e.uiConfig),e.ui=new firebaseui.auth.AuthUI(firebase.auth()),e.ui.start(e.firebaseuidiv.e,e.uiConfig)})},get startfirebase(){return a(this,function(e,t){e.firebaseconfig=t,e.initializefirebase(),e.initializefirebaseui()})},get getuid(){return a(this,function(e){return e.user?e.uid:"mockuser"})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});e.configloaded=!1,e.user=null,"https:"==window.location.protocol?e.ws_scheme="wss://":e.ws_scheme="ws://",e.SUBMIT_URL=e.ws_scheme+window.location.host,ne("creating socket {}".format(e.SUBMIT_URL)),e.rawsocket=io.connect(e.SUBMIT_URL),ne("socket created ok"),e.log=at(),e.connectcallback=t.py_get("connectcallback",null),e.authcallback=t.py_get("authcallback",null),e.siorescallback=t.py_get("siorescallback",null),e.buildsignupdiv(),e.profiletab=et("profile","Profile",e.signupdiv),e.rawsocket&&(e.rawsocket.on("connect",e.onconnect),e.rawsocket.on("siores",e.siores))})}}),st=null,lt=function(){return st},ct=["p","n","b","r","q","k"],ut=[["standard","Standard"],["fromPosition","From Position"],["antichess","Antichess"],["atomic","Atomic"],["chess960","Chess960"],["crazyhouse","Crazyhouse"],["horde","Horde"],["kingOfTheHill","King of the Hill"],["racingKings","Racing Kings"],["threeCheck","Three Check"]],dt=G({p:"Pawn",n:"Knight",b:"Bishop",r:"Rook",q:"Queen",k:"King"}),ft=["n","b","r","q"],pt=["n","b","r","q","k"],ht=[["0","0"],["1","1"],["2","2"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"]],gt=function(e){return"antichess"==e?pt:ft},_t=function(e){return"antichess"==e?"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 1":"racingKings"==e?"8/8/8/8/8/8/krbnNBRK/qrbnNBRQ w - - 0 1":"horde"==e?"rnbqkbnr/pppppppp/8/1PP2PP1/PPPPPPPP/PPPPPPPP/PPPPPPPP/PPPPPPPP w kq - 0 1":"threeCheck"==e?"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 3+3 0 1":"crazyhouse"==e?"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR[] w KQkq - 0 1":"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},mt=l("Piece",[s],{__module__:"basicboard",get __init__(){return a(this,function(e,t,n){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=null;e.kind=t,e.color=n})},get isempty(){return a(this,function(e){return null===e.kind})},get ispiece(){return a(this,function(e){return!e.isempty()})},get __repr__(){return a(this,function(e){return e.isempty()?"Piece[None]":"Piece[{} {}]".format(1==(n=e.color)?"White":0==n?"Black":"Invalidcolor",f(t=e.kind,dt)?dt[t]:"Invalidpiece");var t,n})}}),vt=function(e){return!!f(e,ct)||!!f(e.toLowerCase(),ct)},bt=function(e){if(vt(e)){var t=e.toLowerCase();return mt(t,t==e?0:1)}return ne("warning, piece letter not valid",e),mt()},yt=function(e,t){var n=e.kind;if(1==e.color)n="w"+n;return t+"piece"+n},kt=l("Square",[s],{__module__:"basicboard",get __init__(){return a(this,function(e,t,n){e.file=t,e.rank=n})},get p(){return a(this,function(e,t){return kt(e.file+t.file,e.rank+t.rank)})},get __repr__(){return a(this,function(e){return"Square[file: {} , rank: {}]".format(e.file,e.rank)})},get copy(){return a(this,function(e){return kt(e.file,e.rank)})}}),wt=l("Move",[s],{__module__:"basicboard",get __init__(){return a(this,function(e,t,n,i){if(void 0===i||null!=i&&i.hasOwnProperty("__kwargtrans__"))i=mt();e.fromsq=t,e.tosq=n,e.prompiece=i})},get __repr__(){return a(this,function(e){return"Move [from: {} , to: {} , prom: {}]".format(e.fromsq,e.tosq,e.prompiece)})}}),xt=l("PieceStore",[Se],{__module__:"basicboard",get dragstartfactory(){return a(this,function(e,t,n,i){return function(r){e.show?r.preventDefault():(e.parent.dragkind="set",e.parent.draggedsetpiece=t,e.parent.draggedpdiv=i,e.parent.movecanvashook.x(),n.op(.7))}})},get setstore(){return a(this,function(e,t){for(var n of(e.store=t,e.container.x(),e.pieces=G({}),e.store.py_split(""))){var i=bt(n);if(i.color==e.color)if(f(i.kind,e.pieces))e.pieces[i.kind].mul++;else{var r=Oe().pr().w(e.piecesize).h(e.piecesize),a=Oe().pa().cp().ac(yt(i,e.parent.piecestyle)).w(e.piecesize).h(e.piecesize),o=Oe().pa().cp().ac(yt(i,e.parent.piecestyle)).w(e.piecesize).h(e.piecesize);a.t(0).l(0).sa("draggable",!0).ae("dragstart",e.dragstartfactory(i,a,o)),r.a(a),e.pieces[i.kind]=G({mul:1,p:i,pcdiv:r})}}for(var[s,l]of e.pieces.py_items()){var c=Oe().pa().w(e.muldivsize).h(e.muldivsize).fs(1.3*e.muldivsize).html("{}".format(l.mul));c.l(e.piecesize-e.muldivsize).t(0).ac("storemuldiv"),l.pcdiv.a(c),e.container.a(l.pcdiv)}return e})},get __init__(){return a(this,function(e,t){u(xt,"__init__")(e,"div"),e.show=t.py_get("show",!1),e.parent=t.py_get("parent",zt(G({}))),e.store=t.py_get("store",""),e.color=t.py_get("color",1),e.container=t.py_get("containerdiv",Oe()),e.container.ac("noselect"),e.piecesize=t.py_get("piecesize",e.parent.piecesize),e.muldivsize=_(e.piecesize/2),e.a(e.container),e.setstore(e.store)})}}),zt=l("BasicBoard",[Se],{__module__:"basicboard",get clearcanvases(){return a(this,function(e){e.movecanvas.py_clear(),e.piececanvashook.x()})},get ucitosquare(){return a(this,function(e,t){try{var n=t.charCodeAt(0)-"a".charCodeAt(0),i=e.lastrank-(t.charCodeAt(1)-"1".charCodeAt(0));return kt(n,i)}catch(e){return null}})},get ucitomove(){return a(this,function(e,t){if(f("@",t))try{var n=t.py_split("@"),i=e.ucitosquare(n[1]);return r=wt(i,i,mt(n[0].toLowerCase(),e.turn()))}catch(e){return null}else try{var r=wt(e.ucitosquare(t.__getslice__(0,2,1)),e.ucitosquare(t.__getslice__(2,4,1)));try{h(t)>4&&(r.prompiece=mt(t[4].toLowerCase(),e.turn()))}catch(e){ne("could not parse prompiece")}return r}catch(e){return null}})},get resize(){return a(this,function(e,t,n){for(e.squaresize=35,e.calcsizes();e.totalheight()<n;)e.squaresize++,e.calcsizes();e.squaresize--,e.calcsizes(),e.build()})},get totalheight(){return a(this,function(e){var t=e.outerheight+ze(e.showfen,e.fendivheight,0);return"crazyhouse"==e.variantkey&&(t+=2*e.squaresize),t})},get squareuci(){return a(this,function(e,t){return String.fromCharCode(t.file+"a".charCodeAt(0))+String.fromCharCode(e.lastrank-t.rank+"1".charCodeAt(0))})},get moveuci(){return a(this,function(e,t){return e.squareuci(t.fromsq)+e.squareuci(t.tosq)+ze(t.prompiece.isempty(),"",t.prompiece.kind)})},get islightfilerank(){return a(this,function(e,t,n){return 0==K(t+n,2)})},get islightsquare(){return a(this,function(e,t){return e.islightfilerank(t.file,t.rank)})},get squarelist(){return a(this,function(e){for(var t=[],n=0;n<e.numfiles;n++)for(var i=0;i<e.numranks;i++)t.append(kt(n,i));return t})},get squarecoordsvect(){return a(this,function(e,t){return ge(t.file*e.squaresize,t.rank*e.squaresize)})},get squarecoordsmiddlevect(){return a(this,function(e,t){return e.squarecoordsvect(t).p(ge(e.squaresize/2,e.squaresize/2))})},get piececoordsvect(){return a(this,function(e,t){return e.squarecoordsvect(t).p(ge(e.squarepadding,e.squarepadding))})},get flipawaresquare(){return a(this,function(e,t){return e.flip?kt(e.lastfile-t.file,e.lastrank-t.rank):t})},get piecedragstartfactory(){return a(this,function(e,t,n){return function(i){e.promoting||e.show?i.preventDefault():(e.dragkind="move",e.draggedsq=t,e.draggedpdiv=n,e.movecanvashook.x(),n.op(.1))}})},get piecedragfactory(){return a(this,function(e){return function(e){}})},get piecedragendfactory(){return a(this,function(e,t,n){return function(e){n.op(.5)}})},get piecedragoverfactory(){return a(this,function(e,t){return function(e){e.preventDefault()}})},get ismovepromotion(){return a(this,function(e,t){var n=e.getpieceatsquare(t.fromsq);if("p"==n.kind&&n.color==e.turn())if(e.iswhitesturn()){if(0==t.tosq.rank)return!0}else if(t.tosq.rank==e.lastrank)return!0;return!1})},get piecedropfactory(){return a(this,function(e,t){return function(n){if(n.preventDefault(),e.draggedpdiv.pv(e.piececoordsvect(e.flipawaresquare(t))),e.draggedpdiv.zi(100),"move"==e.dragkind)e.dragmove=wt(e.draggedsq,t),e.ismovepromotion(e.dragmove)?(e.promoting=!0,e.build()):null!==e.movecallback&&e.movecallback(e.variantkey,e.fen,e.moveuci(e.dragmove));else if("set"==e.dragkind&&(e.container.a(e.draggedpdiv),null!==e.movecallback)){var i="{}@{}".format(e.draggedsetpiece.kind,e.squareuci(t));e.movecallback(e.variantkey,e.fen,i)}}})},get buildsquares(){return a(this,function(e){for(var t of(e.container.x(),e.squarelist())){var n=ze(e.islightsquare(t),"boardsquarelight","boardsquaredark"),i=Oe().ac(["boardsquare",n]).w(e.squaresize).h(e.squaresize),r=e.flipawaresquare(t);i.pv(e.squarecoordsvect(r)),i.ae("dragover",e.piecedragoverfactory(t)),i.ae("drop",e.piecedropfactory(t)),e.container.a(i);var a=e.getpieceatsquare(t);if(a.ispiece()){var o=Oe().ac("boardpiece").w(e.piecesize).h(e.piecesize).pv(e.piececoordsvect(r));if(o.ac(yt(a,e.piecestyle)).sa("draggable",!0),o.ae("dragstart",e.piecedragstartfactory(t,o)),o.ae("drag",e.piecedragfactory()),o.ae("dragend",e.piecedragendfactory(t,o)),o.ae("dragover",e.piecedragoverfactory(t)),o.ae("drop",e.piecedropfactory(t)),o.zi(10),"threeCheck"==e.variantkey&&"k"==a.kind){var s=e.getthreelifesforcolor(a.color),l=Oe().pa().t(-e.squaresize/10).l(e.squaresize/2+e.squaresize/10).w(e.squaresize/2).h(e.squaresize/2);l.ac("boardthreechecklifesdiv").fs(e.squaresize/1.5).html("{}".format(s)),l.c(["#ff0","#ff0"][a.color]),o.a(l)}e.container.a(o)}}})},get getthreelifesforcolor(){return a(this,function(e,t){var n=e.threefen.py_split("+"),i=3;if(1==t)try{i=_(n[2])}catch(t){ne("warning, could not parse white lifes from",e.threefen)}if(0==t)try{i=_(n[0])}catch(t){ne("warning, could not parse black lifes from",e.threefen)}return i})},get prompiececlickedfactory(){return a(this,function(e,t){return function(){e.dragmove.prompiece=mt(t,e.turn()),e.movecallback(e.variantkey,e.fen,e.moveuci(e.dragmove))}})},get buildprominput(){return a(this,function(e){gt(e.variantkey);var t=e.dragmove.tosq.copy(),n=ze(t.rank>=e.numranks/2,-1,1),i=gt(e.variantkey);for(var r of i){var a=e.flipawaresquare(t),o=mt(r,e.turn()),s=Oe().pa().cp().zi(150).w(e.squaresize).h(e.squaresize).ac("boardpromotionsquare");s.pv(e.squarecoordsvect(a));var l=Oe().pa().cp().zi(200).w(e.piecesize).h(e.piecesize).ac(yt(o,e.piecestyle));l.pv(e.piececoordsvect(a)).ae("mousedown",e.prompiececlickedfactory(r)),e.container.a([s,l]);t=t.p(kt(0,n))}})},get promotecancelclick(){return a(this,function(e){e.promoting=!1,e.build()})},get drawmovearrow(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=G({});if(null!==t){var i=n.py_get("strokecolor","#FFFF00"),r=n.py_get("linewidth",.2)*e.squaresize,a=n.py_get("headwidth",.2)*e.squaresize,o=n.py_get("headheight",.2)*e.squaresize;e.movecanvas.lineWidth(r),e.movecanvas.strokeStyle(i),e.movecanvas.fillStyle(i);var s=e.squarecoordsmiddlevect(e.flipawaresquare(t.tosq));e.movecanvas.drawline(e.squarecoordsmiddlevect(e.flipawaresquare(t.fromsq)),s);var l=ge(a,o);if(e.movecanvas.fillRect(s.m(l),s.p(l)),!t.prompiece.isempty()){var c=ge(4*r,4*r);t.prompiece.color=e.turn();var u=Oe().pa().cp().ac(yt(t.prompiece,e.piecestyle)).w(2*r*4).h(2*r*4);u.pv(s.m(c)),e.piececanvashook.a(u)}}})},get drawuciarrow(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=G({});e.drawmovearrow(e.ucitomove(t),n)})},get buildgenmove(){return a(this,function(e){if(f("genmove",e.positioninfo)&&"reset"!=n){var t=e.positioninfo.genmove.uci,n=e.ucitomove(t);null!==n&&(n.prompiece=mt(),e.drawmovearrow(n))}})},get fentextchanged(){return a(this,function(e){e.fentextchangedcallback&&e.fentextchangedcallback(e.fentext.getText())})},get build(){return a(this,function(e){return e.sectioncontainer=Oe().ac("boardsectioncontainer").w(e.outerwidth),e.sectioncontainer.bci(e.background),e.outercontainer=Oe().ac("boardoutercontainer").w(e.outerwidth).h(e.outerheight),e.outercontainer.bci(e.background),e.container=Oe().ac("boardcontainer").w(e.width).h(e.height).t(e.margin).l(e.margin),e.container.bci(e.background),e.outercontainer.a(e.container),e.buildsquares(),e.turndiv=Oe().pa().w(e.turndivsize).h(e.turndivsize).bc(ze(e.iswhitesturn(),"#fff","#000")),"racingKings"==e.variantkey?(e.turndiv.t(ze(e.flip,0,e.outerheight-e.turndivsize)),_e(e.isblacksturn(),e.flip)?e.turndiv.l(0):e.turndiv.l(e.outerwidth-e.turndivsize)):e.turndiv.l(e.outerwidth-e.turndivsize).t(ze(_e(e.isblacksturn(),e.flip),0,e.outerheight-e.turndivsize)),e.outercontainer.a(e.turndiv),e.promoting&&(e.buildprominput(),e.container.ae("mousedown",e.promotecancelclick)),e.fentext=Me(G({})).w(e.width).fs(10).setText(e.fen),e.fentext.changecallback=e.fentextchanged,e.fendiv=Oe().ac("boardfendiv").h(e.fendivheight).a(e.fentext),"crazyhouse"==e.variantkey?(e.whitestorediv=Oe().ac("boardstorediv").h(e.squaresize).w(e.outerwidth),e.whitestorediv.bci(e.background),e.blackstorediv=Oe().ac("boardstorediv").h(e.squaresize).w(e.outerwidth),e.blackstorediv.bci(e.background),e.whitestore=xt(G({show:e.show,parent:e,color:1,store:e.crazyfen,containerdiv:e.whitestorediv})),e.blackstore=xt(G({show:e.show,parent:e,color:0,store:e.crazyfen,containerdiv:e.blackstorediv})),e.flip?e.sectioncontainer.a([e.whitestorediv,e.outercontainer,e.blackstorediv]):e.sectioncontainer.a([e.blackstorediv,e.outercontainer,e.whitestorediv])):e.sectioncontainer.a([e.outercontainer]),e.showfen&&e.sectioncontainer.a(e.fendiv),e.x().a(e.sectioncontainer),e.movecanvas=Ve(e.width,e.height).pa().t(0).l(0),e.movecanvashook=Oe().pa().t(0).l(0).zi(5).op(.5),e.piececanvashook=Oe().pa().t(0).l(0).zi(11).op(.5),e.container.a([e.movecanvashook,e.piececanvashook]),e.movecanvashook.a(e.movecanvas),e.buildgenmove(),e})},get setflip(){return a(this,function(e,t){e.flip=t,e.build()})},get calcsizes(){return a(this,function(e){e.lastfile=e.numfiles-1,e.lastrank=e.numranks-1,e.area=e.numfiles*e.numranks,e.width=e.numfiles*e.squaresize,e.height=e.numranks*e.squaresize,e.avgsize=(e.width+e.height)/2,e.margin=e.marginratio*e.avgsize,e.squarepadding=e.squarepaddingratio*e.squaresize,e.piecesize=e.squaresize-2*e.squarepadding,e.outerwidth=e.width+2*e.margin,e.outerheight=e.height+2*e.margin,e.turndivsize=e.margin,e.fendivheight=25})},get parseargs(){return a(this,function(e,t){e.fentextchangedcallback=t.py_get("fentextchangedcallback",null),e.positioninfo=t.py_get("positioninfo",G({})),e.show=t.py_get("show",!1),e.showfen=t.py_get("showfen",!0),e.squaresize=t.py_get("squaresize",45),e.squarepaddingratio=t.py_get("squarepaddingratio",.04),e.marginratio=t.py_get("marginratio",.02),e.numfiles=t.py_get("numfiles",8),e.numranks=t.py_get("numranks",8),e.piecestyle=t.py_get("piecestyle","alpha"),e.flip=t.py_get("flip",!1),e.movecallback=t.py_get("movecallback",null),e.background="/static/img/backgrounds/"+t.py_get("background","wood.jpg"),e.calcsizes()})},get setpieceati(){return a(this,function(e,t,n){t>=0&&t<e.area?e.rep[t]=n:ne("warning, rep index out of range",t)})},get getpieceati(){return a(this,function(e,t){return t>=0&&t<e.area?e.rep[t]:mt()})},get getpieceatfilerank(){return a(this,function(e,t,n){var i=n*e.numfiles+t;return e.getpieceati(i)})},get getpieceatsquare(){return a(this,function(e,t){return e.getpieceatfilerank(t.file,t.rank)})},get setrepfromfen(){return a(this,function(e,t){e.fen=t,e.crazyfen=null,e.threefen=null,e.rep=function(){for(var t=[],n=0;n<e.area;n++)t.append(mt());return t}();var n=e.fen.py_split(" ");e.rawfen=n[0];var i=e.rawfen.py_split("/");if("crazyhouse"==e.variantkey&&(e.crazyfen="",f("[",e.rawfen))){var r=e.rawfen.py_split("[");e.rawfen=r[0];i=e.rawfen.py_split("/"),r=r[1].py_split("]");e.crazyfen=r[0]}var a=0;for(var o of i){var s=o.py_split("");for(var l of s)if(vt(l))e.setpieceati(a,bt(l)),a++;else{var c=0;try{c=_(l)}catch(e){ne("warning, multiplicity could not be parsed from",l)}for(var u=0;u<c;u++)e.setpieceati(a,mt()),a++}}a<e.area?ne("warning, raw fen did not fill board"):a>e.area&&ne("warning, raw fen exceeded board"),e.turnfen="w",h(n)>1?e.turnfen=n[1]:ne("warning, no turn fen"),e.castlefen="-",h(n)>2?e.castlefen=n[2]:ne("warning, no castle fen"),e.epfen="-",h(n)>3?e.epfen=n[3]:ne("warning, no ep fen");var d=ze("threeCheck"==e.variantkey,5,4);if(e.halfmoveclock=0,h(n)>d)try{e.halfmoveclock=_(n[d])}catch(e){ne("warning, half move clock could not be parsed from",n[4])}else ne("warning, no half move fen");if(e.fullmovenumber=1,h(n)>d+1)try{e.fullmovenumber=_(n[d+1])}catch(e){ne("warning, full move number could not be parsed from",n[5])}else ne("warning, no full move fen");"threeCheck"==e.variantkey&&h(n)>4&&(e.threefen=n[4]),e.promoting=!1})},get turn(){return a(this,function(e){return"w"==e.turnfen?1:0})},get iswhitesturn(){return a(this,function(e){return 1==e.turn()})},get isblacksturn(){return a(this,function(e){return 0==e.turn()})},get initrep(){return a(this,function(e,t){e.variantkey=t.py_get("variantkey","standard"),e.setrepfromfen(t.py_get("fen",_t(e.variantkey)))})},get setfromfen(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=G({});e.positioninfo=n,e.setrepfromfen(t),e.build()})},get reset(){return a(this,function(e){e.setfromfen(_t(e.variantkey))})},get __init__(){return a(this,function(e,t){u(zt,"__init__")(e,"div"),e.positioninfo=G({}),e.parseargs(t),e.initrep(t),e.build()})}}),Pt=l("MultipvInfo",[Se],{__module__:"basicboard",get bestmovesanclickedfactory(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=!1;return function(){null!==e.bestmovesanclickedcallback&&e.bestmovesanclickedcallback(t,n)}})},get scorebonus(){return a(this,function(e){if(f("scorebonus",e.infoi))try{return _(e.infoi.scorebonus)}catch(e){}return 0})},get effscore(){return a(this,function(e){return e.scorenumerical+e.scorebonus()})},get bonussliderchanged(){return a(this,function(e){e.infoi.scorebonus=e.bonusslider.v(),e.build(),null!==e.bonussliderchangedcallback&&e.bonussliderchangedcallback()})},get traincombochanged(){return a(this,function(e){e.infoi.metrainweight=e.metraincombo.v(),e.infoi.opptrainweight=e.opptraincombo.v()})},get build(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;if(e.bestmoveuci=e.infoi.bestmoveuci,e.bestmovesan=e.infoi.bestmovesan,e.scorenumerical=e.infoi.scorenumerical,e.pvsan=e.infoi.pvsan,e.pvpgn=e.infoi.pvpgn,e.depth=e.infoi.depth,e.nps=e.infoi.nps,e.container=Oe().ac("multipvinfocontainer"),e.idiv=Oe().ac("multipvinfoi").html("{}.".format(e.i)),e.bestmovesandiv=Oe().ac("multipvinfobestmovesan").html(e.bestmovesan),t==e.bestmovesan&&e.bestmovesandiv.bc("#fbf"),e.bestmovesandiv.ae("mousedown",e.bestmovesanclickedfactory(e.bestmoveuci)),e.scorenumericaldiv=Oe().ac("multipvinfoscorenumerical").html("{}".format(de(e.effscore()))).cp(),e.scorenumericaldiv.ae("mousedown",e.bestmovesanclickedfactory(e.bestmoveuci,!0)),e.bonussliderdiv=Oe().ac("multipvinfobonussliderdiv"),e.bonusslider=Ue().setmin(-500).setmax(500).ac("multipvinfobonusslider").sv(e.scorebonus()),e.bonusslider.ae("change",e.bonussliderchanged),e.bonussliderdiv.a(e.bonusslider),e.depthdiv=Oe().ac("multipvinfodepth").html("{}".format(e.depth)),e.miscdiv=Oe().ac("multipvinfomisc").html("nps {}".format(e.nps)),e.traindiv=Oe().ac("multipvinfomisc").w(100),!(n=e.infoi.metrainweight))var n="0";if(!(i=e.infoi.opptrainweight))var i="0";e.metraincombo=Ne().setoptions(ht,n,e.traincombochanged),e.opptraincombo=Ne().setoptions(ht,i,e.traincombochanged),e.traindiv.a([e.metraincombo,e.opptraincombo]),e.pvdiv=Oe().ac("multipvinfopv").html(e.pvpgn),e.container.a([e.idiv,e.bestmovesandiv,e.scorenumericaldiv,e.bonussliderdiv,e.traindiv,e.depthdiv,e.pvdiv]),e.bestmovesandiv.c(fe(e.effscore())),e.scorenumericaldiv.c(fe(e.effscore())),e.x().a(e.container)})},get __init__(){return a(this,function(e,t){u(Pt,"__init__")(e,"div"),e.bestmovesanclickedcallback=null,e.bonussliderchangedcallback=null,e.infoi=t,e.i=e.infoi.i,e.build()})}}),qt=l("PgnInfo",[Se],{__module__:"basicboard",get __init__(){return a(this,function(e,t){u(qt,"__init__")(e,"div"),e.headers=[],e.parent=t})},get getheader(){return a(this,function(e,t,n){for(var i of e.headers)if(i[0]==t)return i[1];return n})},get playerlink(){return a(this,function(e,t){return"<a href='https://lichess.org/@/{}' target='_blank' rel='noopener noreferrer'>{}</a>".format(t,t)})},get parsecontent(){return a(this,function(e){var t=e.content.py_split("\n");for(var n of(e.headers=[],t))if("["==n[0]){var i=n.__getslice__(1,null,1).py_split('"'),r=i[0].py_split(" ")[0],a=i[1].py_split('"')[0];e.headers.append(T([r,a]))}e.white=e.getheader("White","?"),e.black=e.getheader("Black","?"),e.result=e.getheader("Result","?"),e.site=e.getheader("Site",""),e.whiteelo=e.getheader("WhiteElo","?"),e.whiteratingdiff=e.getheader("WhiteRatingDiff","?"),e.blackelo=e.getheader("BlackElo","?"),e.blackratingdiff=e.getheader("BlackRatingDiff","?"),e.variant=e.getheader("Variant","Standard"),e.timecontrol=e.getheader("TimeControl","?"),e.utcdate=e.getheader("UTCDate","?"),e.id=e.site.py_split("/").__getslice__(-1,null,1)[0]})},get idclicked(){return a(this,function(e){e.parent.pgntext.setpgn(e.content),lt().sioreq(G({kind:"parsepgn",owner:e.parent.id,data:e.content}))})},get mecolor(){return a(this,function(e){return e.white==e.parent.username?1:e.black==e.parent.username?0:null})},get mewhite(){return a(this,function(e){return 1==e.mecolor()})},get meblack(){return a(this,function(e){return 0==e.mecolor()})},get hasme(){return a(this,function(e){return!(null===e.mecolor())})},get score(){return a(this,function(e){return"1-0"==e.result?1:"0-1"==e.result?0:.5})},get mescore(){return a(this,function(e){return e.hasme()?e.mewhite()?e.score():1-e.score():e.score()})},get meratinginfo(){return a(this,function(e){return e.hasme()?e.mewhite()?[e.whiteelo,e.whiteratingdiff]:[e.blackelo,e.blackratingdiff]:null})},get build(){return a(this,function(e){e.x().ac("pgninfocontainer"),e.tcdiv=Oe().ac("pgninfotcdiv").html("{} {}".format(e.timecontrol,e.variant)),e.whitediv=Oe().ac("pgninfoplayerdiv").html(e.playerlink(e.white)),e.whiteelodiv=Oe().ac("pgninfoplayerelodiv").html("{} {}".format(e.whiteelo,e.whiteratingdiff)),e.meblack()&&e.whitediv.ac("pgninfotheyplayerdiv"),e.blackdiv=Oe().ac("pgninfoplayerdiv").html(e.playerlink(e.black)),e.blackelodiv=Oe().ac("pgninfoplayerelodiv").html("{} {}".format(e.blackelo,e.blackratingdiff)),e.mewhite()&&e.blackdiv.ac("pgninfotheyplayerdiv"),e.resultdiv=Oe().ac("pgninforesultdiv").html(e.result),e.iddiv=Oe().ac("pgninfoiddiv").html(e.id),e.iddiv.ae("mousedown",e.idclicked);var t=e.mescore();return 1==t?e.ac("pgninfowhitewin"):0==t?e.ac("pgninfoblackwin"):e.ac("pgninfodraw"),e.a([e.tcdiv,e.whitediv,e.whiteelodiv,e.blackdiv,e.blackelodiv,e.resultdiv,e.iddiv]),e})},get setcontent(){return a(this,function(e,t){return e.content=t,e.parsecontent(),e.build()})}}),St=l("CandleStickChart",[Se],{__module__:"basicboard",get __init__(){return a(this,function(e,t){u(St,"__init__")(e,"div"),e.BARWIDTH=t.py_get("barwidth",20),e.BARSEPARATION=_(1.1*e.BARWIDTH),e.YHEIGHT=t.py_get("yheight",2),e.CLUSTER=t.py_get("cluster",50),e.data=t.py_get("data",[]);var n=!0;for(var i of e.data){var r=i.min,a=i.max;if(n){var o=r,s=a;n=!1}else{if(r<o)o=r;if(a>s)s=a}}o-=K(o,e.CLUSTER),s=s-K(s,e.CLUSTER)+e.CLUSTER;var l=e.BARSEPARATION*h(e.data);e.w(l);var c=s-o,d=c*e.YHEIGHT;e.h(d),e.pr().bc("#ffc");for(var f=1;f<c/e.CLUSTER;f++){var p=s-f*e.CLUSTER,g=f*e.CLUSTER*e.YHEIGHT,m=Oe().pa().t(g).l(0).w(l).h(1).bc("#000"),v=Oe().pa().t(g+5).ms().html(p);e.a([m,v])}f=0;for(var i of e.data){var b=(c-((r=i.min)-o))*e.YHEIGHT,y=(c-((a=i.max)-o))*e.YHEIGHT,k=(c-(i.open-o))*e.YHEIGHT,w=(c-(i.close-o))*e.YHEIGHT,P=f*e.BARSEPARATION,q=Oe().pa().t(x(k,w)).l(P+1).w(e.BARWIDTH).h(z(k-w)).bc(ze(k<w,"#f00","#0f0")),S=Oe().pa().t(y).l(P+_(e.BARWIDTH/2)-1+1).w(2).h(b-y).bc("#007");e.a([S,q]),f++}})}}),Ot=l("PgnList",[Se],{__module__:"basicboard",get __init__(){return a(this,function(e,t){u(Ot,"__init__")(e,"div"),e.parent=t})},get build(){return a(this,function(e){e.x();var t=!0,n=[];for(var i of e.gamecontents){var r=qt(e.parent).setcontent(i);e.a(r);var a=r.meratinginfo();if(a){var o=1500,s=0;try{o=_(a[0])}catch(e){}try{s=_(a[1])}catch(e){}var l=o+s;if(t){var c=r.utcdate,u=x(o,l),d=w(o,l),f=o,p=l;t=!1}else{if(c!=r.utcdate){n.push(G({date:c,min:u,max:d,open:f,close:p}));u=x(o,l),d=w(o,l),p=l,c=r.utcdate}if(o>d)d=o;if(o<u)u=o;if(l>d)d=l;if(l<u)u=l;f=o}}}e.parent.chartdiv.x().a(St(G({barwidth:e.parent.BARWIDTH,yheight:e.parent.RATINGHEIGHT,cluster:e.parent.RATINGCLUSTER,data:n})));var h=Ce(),g=Ee();for(var m of(g.a(Ie("chartdataheadtd").html("Date")),g.a(Ie("chartdataheadtd").html("Min")),g.a(Ie("chartdataheadtd").html("Max")),g.a(Ie("chartdataheadtd").html("Open")),g.a(Ie("chartdataheadtd").html("Close")),h.a(g),n)){(g=Ee()).a(Ie("chartdatatd").html(m.date)),g.a(Ie("chartdatatd").html(m.min)),g.a(Ie("chartdatatd").html(m.max)),g.a(Ie("chartdatatd").html(m.open)),g.a(Ie("chartdatatd").html(m.close)),h.a(g)}return e.parent.chartdiv.a(h),e})},get setcontent(){return a(this,function(e,t){return e.content=t,e.gamecontents=e.content.py_split("\n\n\n").__getslice__(0,-1,1),e.build()})}}),Tt=l("PgnText",[Se],{__module__:"basicboard",get __init__(){return a(this,function(e){u(Tt,"__init__")(e,"div"),e.ac("pgntextcontainer"),e.textarea=Ke(),e.a(e.textarea),e.resize(600,300)})},get setpgn(){return a(this,function(e,t){return e.textarea.setText(t),e})},get getpgn(){return a(this,function(e){return e.textarea.getText()})},get resize(){return a(this,function(e,t,n){return e.width=t,e.height=n,e.textarea.w(t-15).h(n-15),e})}}),At=l("Forumnode",[Se],{__module__:"forumgame",get __init__(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=G({});u(At,"__init__")(e,"div"),e.root=t,e.move=n.move,e.uci=n.uci,e.comment=n.comment,e.comment||(e.comment=""),e.owner=n.owner,e.fen=n.fen,e.parent=n.parent,e.isadmin=n.isadmin,e.halfmoveno=n.halfmoveno,e.halfmoveno||(e.halfmoveno=-1),e.childs=[],e.build()})},get toobj(){return a(this,function(e){var t=G({});for(var n of e.childs)t[n.move]=n.toobj();return G({uci:e.uci,comment:e.comment,owner:e.owner,fen:e.fen,moves:t})})},get appendchild(){return a(this,function(e,t){if(t.halfmoveno=e.halfmoveno+1,t.build(),e.childs.append(t),e.containerdiv.a(t),h(e.childs)>1){var n="rgb({},{},{})".format(_(128*ue()+127),_(128*ue()+127),_(128*ue()+127));e.containerdiv.bc(n).bds("solid").bdw(10).bdr(20).bdc(n)}})},get addnode(){return a(this,function(e){var t=window.prompt("Move:uci:owner:fen","");if(t){e.root.shift();var n=t.py_split(":");e.appendchild(At(e.root,G({move:n[0],uci:null,comment:"",uci:n[0],owner:n[2],fen:n[2],parent:e,isadmin:e.isadmin}))),e.root.parse()}})},get edituci(){return a(this,function(e){var t=window.prompt("Uci","");t&&(e.uci=t,e.setboard(),e.ucidiv.html(e.uci),e.root.parse())})},get editfen(){return a(this,function(e){var t=window.prompt("Fen","");t&&(e.fen=t,e.setboard(),e.root.parse())})},get setmovelabel(){return a(this,function(e){if(e.halfmoveno<0)var t="";else if(0==K(e.halfmoveno,2))t=(e.halfmoveno+2)/2+". ";else t=(e.halfmoveno+1)/2+".. ";e.movelabeldiv.html("{}{}".format(t,e.move))})},get editsan(){return a(this,function(e){var t=window.prompt("San","");t&&(e.move=t,e.setmovelabel(),e.root.parse())})},get editcomment(){return a(this,function(e){var t=window.prompt("Comment",e.comment);t&&(e.comment=t,e.commentdiv.html(e.comment),e.root.parse())})},get editowner(){return a(this,function(e){var t=window.prompt("Owner","");t&&(e.owner=t,e.ownerdiv.html(e.owner),e.root.parse())})},get movecallback(){return a(this,function(e,t,n,i){e.reqfenunderway?ne("a fen request is in progress, cannot start a new one"):(e.root.shift(),e.root.reqfenunderway=!0,e.root.reqnode=e,lt().sioreq(G({kind:"forumgamemove",owner:"forumgame",moveuci:i,variantkey:t,fen:n})))})},get bbdragstart(){return a(this,function(e,t){t.stopPropagation()})},get setboard(){return a(this,function(e){var t=G({fen:e.fen,squaresize:20,showfen:!1,movecallback:e.movecallback,variantkey:"atomic"});e.uci&&(t.positioninfo=G({genmove:G({uci:e.uci})}));var n=zt(t);n.cp().ae("dragstart",e.bbdragstart),e.boarddiv.x().a(n)})},get analyzelocal(){return a(this,function(e){try{e.root.mainboard.variantchanged("atomic",e.fen),e.root.parenttabpane.selectbykey("board")}catch(e){}})},get analyzelichess(){return a(this,function(e){window.open("https://lichess.org/analysis/atomic/"+e.fen,"_blank")})},get delchilds(){return a(this,function(e){e.childs=[],e.root.rebuild(80)})},get delme(){return a(this,function(e){var t=e.parent;if(t){var n=[];for(var i of t.childs)ne("child",i.move,i.uci),i!=e&&n.append(i);t.childs=n,e.root.rebuild(80)}})},get serializefunc(){return a(this,function(e){e.root.rebuild(81),e.root.store()})},get serialize(){return a(this,function(e){e.infohook.html("serializing"),setTimeout(e.serializefunc,100)})},get copysrc(){return a(this,function(e){e.root.copysrc()})},get copylink(){return a(this,function(e){var t=Me();e.linktexthook.a(t),t.setText("https://fbserv.herokuapp.com/analysis/atomic/"+e.fen.py_replace(" ","%20")),t.e.select(),document.execCommand("copy"),e.linktexthook.x()})},get build(){return a(this,function(e){e.movediv=Oe().disp("flex").fd("row").ai("center"),e.movedescdiv=Oe().bc("#eee").w(110).maw(110).pad(3),e.movelabeldiv=Oe().fw("bold").pad(3).ff("monospace"),e.setmovelabel(),e.ownerdiv=Oe().html(e.owner).ff("monospace").fs("10").c("#007"),e.ucidiv=Oe().ff("monospace").fs("12").pad(3),e.commentdiv=Oe().fs("12").pad(5).html(e.comment),e.uci&&e.ucidiv.html(e.uci),e.movedescdiv.a([e.movelabeldiv,e.ownerdiv,e.commentdiv]),e.movedescdiv.a(je("Analyze local",e.analyzelocal).mar(2)),e.movedescdiv.a(je("Analyze lichess",e.analyzelichess).mar(2)),e.infohook=Oe().ff("monospace").pad(3).c("#007").fw("bold").html("built"),e.isadmin&&(e.movedescdiv.a(e.infohook),e.linktexthook=Oe(),e.movedescdiv.a(e.ucidiv),e.movedescdiv.a(je("+",e.addnode).pad(5)),e.movedescdiv.a(je("san",e.editsan).pad(5)),e.movedescdiv.a(je("uci",e.edituci).pad(5)),e.movedescdiv.a(je("fen",e.editfen).pad(5)),e.movedescdiv.a(je("comment",e.editcomment).pad(5)),e.movedescdiv.a(je("owner",e.editowner).pad(5)),e.movedescdiv.a(je("serialize",e.serialize).pad(5).bc("#ffa")),e.movedescdiv.a(je("copy",e.copysrc).pad(5).bc("#afa")),e.movedescdiv.a(e.linktexthook),e.movedescdiv.a(je("link",e.copylink).pad(5).bc("#aff")),e.movedescdiv.a(je("delchilds",e.delchilds).pad(5).bc("#faa")),e.movedescdiv.a(je("delme",e.delme).pad(5).bc("#faa"))),e.boarddiv=Oe().pad(2),e.movecontainerdiv=Oe().disp("flex").fd("row").ai("center"),e.movecontainerdiv.a([e.movedescdiv,e.boarddiv]),e.containerdiv=Oe().disp("flex").fd("column").ai("flex-start"),e.movediv.a([e.movecontainerdiv,e.containerdiv]),e.setboard(),e.x().a(e.movediv),e.mw(600)})}}),Ct=l("Forumgame",[Se],{__module__:"forumgame",get __init__(){return a(this,function(e){u(Ct,"__init__")(e,"div"),e.messagediv=Oe().disp("inline-block").pad(3).ff("monospace"),e.contentdiv=Oe(),e.a([e.messagediv,e.contentdiv]),e.reqfenunderway=!1,e.reqnode=null,e.requestforumgame(),e.ae("mousemove",e.mousemove),e.ae("mouseup",e.mouseup),e.ae("mouseleave",e.mouseleave)})},get copysrc(){return a(this,function(e){e.textarea.e.select(),document.execCommand("copy"),window.alert("Copied source to clipboard, {} characters.".format(h(e.textarea.getText())))})},get mousemove(){return a(this,function(e,t){if(e.dragunderway){var n=t.clientX-e.dragstartx,i=t.clientY-e.dragstarty;e.parenttabpane.contentdiv.e.scrollTop=e.scrolltop+20*i,e.parenttabpane.contentdiv.e.scrollLeft=e.scrollleft+20*n}})},get mouseup(){return a(this,function(e,t){e.dragunderway=!1})},get mouseleave(){return a(this,function(e,t){e.dragunderway=!1})},get parse(){return a(this,function(e){var t=e.rootnode.toobj(),n=JSON.stringify(t,null,2);return e.textarea.setText(n),n})},get store(){return a(this,function(e){e.parenttabpane.contentdiv.bc("#faa"),e.messagediv.html("Parsing JSON");try{var t=JSON.parse(e.textarea.getText());e.messagediv.html("Storing JSON"),lt().sioreq(G({kind:"setforumgame",owner:"forumgame",forumgame:t}))}catch(t){return void e.messagediv.html("Error: could not parse JSON")}})},get requestforumgame(){return a(this,function(e){lt().sioreq(G({kind:"getforumgame",owner:"forumgame"}))})},get buildrec(){return a(this,function(e,t,n){if(n.moves)for(var i in n.moves){var r=n.moves[i],a=At(e,{move:i,uci:r.uci,comment:r.comment,owner:r.owner,fen:r.fen,parent:t,isadmin:e.isadmin});t.appendchild(a),e.buildrec(a,r)}})},get build(){return a(this,function(e,t,n){ce=n,e.contentdiv.x().pad(3),e.textarea=Ke().w(1e3).h(200),e.textarea.setText(t),e.controlpanel=Oe(),e.controlpanel.a(je("Store",e.store)),e.isadmin&&(e.contentdiv.a(e.textarea),e.contentdiv.a(e.controlpanel)),e.rootnode=At(e,G({move:"startpos",uci:null,owner:"Wolfram_EP",comment:"Forum game",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",parent:null,isadmin:e.isadmin})),e.contentdiv.a(e.rootnode),e.buildrec(e.rootnode,e.forumgame),e.parenttabpane.setscroll(),e.contentdiv.sa("draggable",!0).cm().ae("dragstart",e.dragstart)})},get dragstart(){return a(this,function(e,t){t.preventDefault(),e.dragstartx=t.clientX,e.dragstarty=t.clientY,e.scrolltop=e.parenttabpane.contentdiv.e.scrollTop,e.scrollleft=e.parenttabpane.contentdiv.e.scrollLeft,e.dragunderway=!0})},get rebuild(){return a(this,function(e,t){var n=e.parse();e.forumgame=JSON.parse(n),e.build(n,t)})},get shift(){return a(this,function(e){var t=e.parenttabpane.contentdiv.e.scrollLeft;e.parenttabpane.contentdiv.e.scrollLeft=t+300})},get siores(){return a(this,function(e,t){if("setforumgame"==t.kind&&(e.forumgame=t.forumgame,e.messagediv.html("Forumgame loaded"),e.isadmin=t.isadmin,"true"==ae.py_get("noadmin","false")&&(e.isadmin=!1),e.build(JSON.stringify(e.forumgame,null,2),80),e.parenttabpane.contentdiv.bc("#def")),"setforumgamedone"==t.kind&&(e.messagediv.html("Stored, refreshing"),e.requestforumgame()),"setforumgamefen"==t.kind){var n=t.positioninfo,i=t.fen,r=n.genmove.san,a=n.genmove.uci,o=e.reqnode.parent,s=null;if(o)s=o.owner;if(!s)s=window.prompt("Owner","?");if(!s)s="?";e.reqnode.appendchild(At(e,G({move:r,uci:a,comment:"",owner:s,fen:i,parent:e.reqnode,isadmin:e.isadmin}))),e.parse()}})}}),Et=l("Board",[Se],{__module__:"board",get flipcallback(){return a(this,function(e){e.basicboard.setflip(!e.basicboard.flip),e.flip=e.basicboard.flip,localStorage.setItem("mainboardflip",e.flip)})},get getstoredauto(){return a(this,function(e){e.autoinfo=null,e.buildauto(),e.dostoredauto&&lt().sioreq(G({kind:"getstoredauto",owner:e.id,bookname:e.getautoname(),variantkey:e.basicboard.variantkey,fen:e.basicboard.fen}))})},get setfromfen(){return a(this,function(e,t,n,i){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=G({});if(void 0===i||null!=i&&i.hasOwnProperty("__kwargtrans__"))i=!0;e.trainfen=null;var r=!1;if(e.analyzing.py_get()){e.stopanalyzecallback();r=!0}i&&f("genmove",n)&&("reset"==n.genmove?e.history=[]:e.history.append(G({fen:e.basicboard.fen,positioninfo:e.positioninfo})));e.positioninfo=n,e.movelist=ze(f("movelist",e.positioninfo),e.positioninfo.movelist,[]),e.basicboard.setfromfen(t,e.positioninfo),e.basicboard.setflip(e.flip),e.buildpositioninfo(),r&&e.analyzecallbackfactory()(),e.getstoredanalysisinfo(),e.getstoredauto(),e.storeposinfo()})},get getbookpage(){return a(this,function(e){e.dobook&&(e.bookdiv.x(),lt().sioreq(G({kind:"getbook",variantkey:e.basicboard.variantkey,path:e.bookpath,drive:e.bookdrive,fen:e.basicboard.fen,owner:e.id})))})},get getstoredanalysisinfo(){return a(this,function(e){e.getbookpage(),e.analysisinfodiv.x(),!e.analyzing.py_get()&&e.dostoredanalysis&&lt().sioreq(G({kind:"retrievedb",owner:e.id,path:"analysisinfo/{}/{}".format(e.basicboard.variantkey,e.positioninfo.zobristkeyhex)}))})},get setvariantcombo(){return a(this,function(e){e.variantcombo.setoptions(ut,e.basicboard.variantkey,e.variantchanged)})},get posclickedfactory(){return a(this,function(e,t){return function(){e.gamei=t;var n=e.positioninfos[t];e.setfromfen(n.fen,n.positioninfo);for(var i=0;i<h(e.positioninfos);i++)e.posdivs[i].arc(i==e.gamei,"boardposdivselected"),i==e.gamei&&e.posdivs[i].e.scrollIntoView(G({block:"center",inline:"center"}));e.history=[]}})},get selectgamei(){return a(this,function(e,t){h(e.positioninfos)>0&&e.posclickedfactory(t)()})},get gamehere(){return a(this,function(e){e.selectgamei(e.gamei)})},get gametobegin(){return a(this,function(e){e.gamei=0,e.selectgamei(e.gamei)})},get gameback(){return a(this,function(e){e.gamei--,e.gamei<0&&(e.gamei=0),e.selectgamei(e.gamei)})},get gameforward(){return a(this,function(e){e.gamei++,e.gamei>=h(e.positioninfos)&&(e.gamei=h(e.positioninfos)-1),e.selectgamei(e.gamei)})},get gametoend(){return a(this,function(e){e.gamei=h(e.positioninfos)-1,e.selectgamei(e.gamei)})},get buildgame(){return a(this,function(e){e.gamediv.x(),e.posdivs=[];var t=0;for(var n of e.positioninfos){var i=n.fen,r=n.positioninfo,a="*";if(f("genmove",r))a=r.genmove.san;var o=Oe().ac("boardposdiv");e.posdivs.append(o),o.ae("mousedown",e.posclickedfactory(t));var s=Oe().ac("boardposmovediv").html(a),l=Oe().ac("boardposfendiv");if(e.dogamepreview){var c=zt(G({show:!0,showfen:!1,positioninfo:r,fen:i,squaresize:20,flip:e.flip}));l.a(c)}else o.w(500).mt(4),l.w(400).pl(4).ml(4).mr(4),l.html(i);o.a([s,l]),e.gamediv.a(o),t++}e.gamei=0,e.gamehere()})},get entryclickedfactory(){return a(this,function(e,t){return function(){null!==e.moveclickedcallback&&e.moveclickedcallback(e.basicboard.variantkey,e.basicboard.fen,t)}})},get setbook(){return a(this,function(e,t){for(var n of(e.entrieslist=t.entrieslist,e.bookdiv.x(),e.bookcontrolpanel=Oe().ac("bigboardanalysiscontrolpanel").w(260),e.addgamecontrolbuttons(e.bookcontrolpanel),e.bookdiv.a(e.bookcontrolpanel),e.entrieslist)){var i=n.uci,r=n.san,a=n.weight,o=Oe("pbookediv"),s=Oe("pucidiv").html(i),l=Oe("psandiv").html(r),c=Oe("pweightdiv").html(a);o.a([l,s,c]),o.ae("mousedown",e.entryclickedfactory(i)),e.bookdiv.a(o)}})},get automoveclickedfactory(){return a(this,function(e,t){return function(){e.addmovemode?(e.addmovecallback(),e.addmovetobook(move)):null!==e.moveclickedcallback&&e.moveclickedcallback(e.basicboard.variantkey,e.basicboard.fen,t)}})},get getautoname(){return a(this,function(e){return e.autoname=localStorage.getItem("autoname/"+e.basicboard.variantkey),e.autoname||(e.autoname="default"),e.autoname})},get changebookname(){return a(this,function(e){var t=window.prompt("Enter book name.",e.getautoname());t&&(localStorage.setItem("autoname/"+e.basicboard.variantkey,t),e.getstoredauto())})},get setenvvarfactory(){return a(this,function(e,t,n){if("ANALYSISROOT"==t)n=e.basicboard.fen;return function(){var i=window.prompt("Enter value for move {}:".format(t),n);i&&lt().sioreq(G({kind:"setenvvar",key:t,value:i,owner:e.id}))}})},get buildauto(){return a(this,function(e){if(e.autodiv.x(),e.autonamediv=Oe().pad(5).ff("monospace"),e.booknamediv=Oe().disp("inline-block").pad(1).pl(8).bc("#cfc").par(8).fs(16).curlyborder().html(e.getautoname()),e.autonamediv.a(e.booknamediv),e.envvarsdiv=Oe().ml(3),e.posdict){for(var t of(e.autobookinfodiv=Oe().disp("inline-block"),e.autobookinfodiv.a(Oe().disp("inline-block").pad(3).ml(5).bc("#eef").fs(14).html("numpos {}".format(e.posdict.numpos))),e.autobookinfodiv.a(Oe().disp("inline-block").pad(3).ml(5).bc("#fee").html("mod {}".format(e.posdict.mod))),e.autobookinfodiv.a(Oe().disp("inline-block").pad(3).ml(5).bc("#fee").html("maxnumbpos {}".format(e.posdict.maxnumbpos))),e.autobookinfodiv.a(Oe().disp("inline-block").pad(3).ml(5).bc("#fee").html("maxtotalblobsize {}".format(e.posdict.maxtotalblobsize))),e.autonamediv.a(e.autobookinfodiv),e.posdict.envvars)){var n=t[0],i=t[1],r=Oe().cp().fs(10).mar(2).pad(2).bc("#eee").disp("inline-block").html(n);r.ae("mousedown",e.setenvvarfactory(n,i));var a=Oe().fs(10).pad(2).bc("#efe").disp("inline-block").html(i);e.envvarsdiv.a([r,a])}e.updatesdiv=Oe().ff("monospace").fs(11),e.updatesdiv.a(Oe().disp("inline-block").pad(3).mb(1).mt(1).ml(5).bc("#ffe").html("buildinfo {}".format(e.posdict.buildinfo))),e.updatesdiv.a(Oe().disp("inline-block").pad(3).mb(1).mt(1).ml(5).bc("#fee").html("lastsync {}".format(e.posdict.lastsync))),e.updatesdiv.a(Oe().disp("inline-block").pad(3).mb(1).mt(1).ml(5).bc("#fee").html("lastupload {}".format(e.posdict.lastupload))),e.updatesdiv.a(Oe().disp("inline-block").pad(3).mb(1).mt(1).ml(5).bc("#fee").html("lastminimax {}".format(e.posdict.lastminimax))),e.updatesdiv.a(Oe().disp("inline-block").pad(3).mb(1).mt(1).ml(5).bc("#fee").html("lastadd {}".format(e.posdict.lastadd)))}if(e.autbookbuttonsdiv=Oe().mt(3),e.autbookbuttonsdiv.a(je("Change book name",e.changebookname)),e.autbookbuttonsdiv.a(je("Analyze lichess",e.lichessanalysisclicked).ml(5)),e.autodiv.a(e.autonamediv),e.autonamediv.a(e.autbookbuttonsdiv),e.updatesdiv&&e.autodiv.a(e.updatesdiv),e.autodiv.a(e.envvarsdiv),e.autoinfo)for(var t of(e.autoinfo=ee(e.autoinfo,c({key:function(e){return e.evaluation},reverse:!0})),e.autoinfo)){var o=t.score,s=t.evaluation,l=t.haspv,u=t.algeb,d=t.depth,f=Oe().disp("flex").ai("center"),p=t.san;l>0&&(p+=" ...");var h=Oe().w(80).bc("#ffe").ta("center").pad(3).fs(20).cp().fw("bold").html(p).c(fe(s)).mar(2);h.ae("mousedown",e.automoveclickedfactory(u)),f.a(h);var g=Oe().w(80).bc("#efe").ta("center").pad(3).fs(20).cp().fw("bold").html(de(s)).c(fe(s)).mar(2);f.a(g);var _=C(l);if(0==l)_="-";var m=Oe().w(80).bc("#fef").ta("center").pad(3).fs(14).cp().html(_).mar(2).fst("italic").fw("bold");f.a(m);var v=Oe().w(80).bc("#eef").ta("center").pad(3).fs(20).cp().fw("bold").html(d).c("#007").mar(2);f.a(v);var b=Oe().w(80).bc("#eee").ta("center").pad(3).fs(20).cp().fw("bold").html(de(o)).c(fe(o)).mar(2);f.a(b),e.autodiv.a(f)}})},get sioresfunc(){return a(this,function(e,t){var n=t.dataobj;n&&((f=n.analysisinfo)&&e.processanalysisinfo(f,!0));var i=t.historyobj;if(i){var r=i.uci_variant,a=i.chess960,o=i.pgn,s=qt(e).setcontent(o),l=function(e,t){(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))&&(t=!1);return"chess"==e?t?"chess960":"standard":"giveaway"==e?"antichess":"kingofthehill"==e?"kingOfTheHill":"racingkings"==e?"racingKings":"3check"==e?"threeCheck":e}(r,a);e.variantchanged(l,null,!1),e.flip=s.meblack(),e.basicboard.setflip(e.flip),localStorage.setItem("mainboardflip",e.flip),e.positioninfos=i.positioninfos,e.buildgame(),e.tabpane.selectbykey("analysis")}var c=t.kind;if("engineout"==c){var u=t.sline;(d=rt(G({text:u,kind:"success",prompt:"out > "}))).container.pad(3).mar(3).bc("#eee"),e.engineoutlog.log(d)}else if("enginein"==c){var d;u=t.sline;(d=rt(G({text:u,kind:"info",prompt:"command > "}))).container.pad(3).mar(3).bc("#ffe"),e.engineoutlog.log(d)}else if("analysisinfo"==c){var f=t.analysisinfo;e.processanalysisinfo(f)}else if("setbook"==c)e.setbook(t);else if("setmainboardfen"==c){var p=t.fen,h=t.positioninfo;e.setfromfen(p,h)}else if("addmovetobookok"==c){var g=t.moveuci,_=t.movesan,m=t.numpositions,v=t.nummoves;window.alert("Move {} [ {} ] was added to the book ! Book contains {} position(s) and {} move(s).".format(_,g,m,v)),e.getbookpage()}else if("setstoredauto"==c){var b=t.posdict;if(e.posdict=b,!b)return;for(var y in e.autoinfo=[],b.moves){var k=b.moves[y],w=k.algeb,x=k.score,z=k.eval,P=k.haspv,q=k.depth;for(var S of e.positioninfo.movelist)if(S.uci==w){var O=S.san;e.autoinfo.append(G({algeb:w,san:O,score:x,evaluation:z,haspv:P,depth:q}))}}e.buildauto()}})},get siores(){return a(this,function(e,t){if("prod"==ie())try{e.sioresfunc(t)}catch(e){ne("error processing siores",t)}else e.sioresfunc(t)})},get addmovecallback(){return a(this,function(e){e.addmovemode=!e.addmovemode,e.movelistdiv.arc(e.addmovemode,"movelistaddmovemode")})},get setbookpath(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=!1;e.bookpath=t,e.bookdrive=n,e.bookpathdiv.html(e.bookpath),e.bookpathdiv.c(ze(e.bookdrive,"#070","#700")),e.addmovehook.x(),e.bookdrive&&e.addmovehook.a(je("Add move",e.addmovecallback))})},get storeposinfo(){return a(this,function(e){lt().sioreq(G({kind:"storeposinfo",path:"board/{}/posinfo".format(lt().getuid()),owner:e.id,dataobj:G({variantkey:e.basicboard.variantkey,fen:e.basicboard.fen})}))})},get variantchanged(){return a(this,function(e,t,n,i){if(void 0===i||null!=i&&i.hasOwnProperty("__kwargtrans__"))i=!0;e.basicboard.variantkey=t,e.basicboard.reset(),n&&e.basicboard.setfromfen(n);try{e.basicboard.resize(e.resizewidth,e.resizeheight)}catch(e){}try{e.resizetabpanewidth(e.resizewidth)}catch(e){}null!==e.variantchangedcallback&&i&&e.variantchangedcallback(e.basicboard.variantkey,e.basicboard.fen),e.basicresize(),e.setvariantcombo(),e.setbookpath("books/"+e.basicboard.variantkey+".bin"),e.setfromfen(e.basicboard.fen),e.buildauto()})},get setvariantcallback(){return a(this,function(e){e.variantchanged(e.basicboard.variantkey,null)})},get addmovetobook(){return a(this,function(e,t){var n=t.uci,i=t.san,r=1,a=window.prompt("Enter weight for move {} [ {} ] :".format(i,n),"1");if(a&&""!=a)try{r=_(a)}catch(e){}lt().sioreq(G({kind:"addmovetobook",variantkey:e.basicboard.variantkey,fen:e.basicboard.fen,moveuci:n,movesan:i,weight:r,owner:e.id,path:e.bookpath,drive:e.bookdrive}))})},get moveclickedfactory(){return a(this,function(e,t){return function(){e.addmovemode?(e.addmovecallback(),e.addmovetobook(t)):null!==e.moveclickedcallback&&e.moveclickedcallback(e.basicboard.variantkey,e.basicboard.fen,t.uci)}})},get buildpositioninfo(){return a(this,function(e){for(var t of(e.movelistdiv.x().h(e.totalheight()),e.movelist)){var n=Oe().ac("bigboardshowmove").html(t.san);n.ae("mousedown",e.moveclickedfactory(t)),e.movelistdiv.a(n)}})},get delcallback(){return a(this,function(e){if(h(e.history)>0){var t=e.history.py_pop();e.setfromfen(t.fen,t.positioninfo,!1)}})},get clearcallback(){return a(this,function(e){for(var t=null;h(e.history)>0;)t=e.history.py_pop();return t})},get delallcallback(){return a(this,function(e){var t=e.clearcallback();t&&e.setfromfen(t.fen,t.positioninfo,!1)})},get totalheight(){return a(this,function(e){return e.basicboard.totalheight()+e.controlpanelheight})},get controlwidth(){return a(this,function(e){return w(e.basicboard.outerwidth,e.controlpanelwidth)})},get totalwidth(){return a(this,function(e){return e.controlwidth()+e.movelistdivwidth+e.enginebardivwidth})},get basicresize(){return a(this,function(e){e.controlpanel.w(e.controlwidth()).mw(e.controlwidth()),e.sectioncontainer.w(e.controlwidth()),e.tabpane.resize(null,e.totalheight())})},get resizetabpanewidth(){return a(this,function(e,t){e.tabpane.resize(w(t-e.totalwidth(),600),null)})},get resizetask(){return a(this,function(e){e.resizewidth=e.resizeorigwidth,e.resizeheight=e.resizeorigheight-e.controlpanelheight,e.basicboard.resize(e.resizewidth,e.resizeheight),e.basicresize(),e.buildpositioninfo(),e.resizetabpanewidth(e.resizeorigwidth),e.setenginebar()})},get resize(){return a(this,function(e,t,n){e.resizeorigwidth=t,e.resizeorigheight=n,e.resizetask()})},get analyzecallbackfactory(){return a(this,function(e,t,n,i){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=!1;if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=null;if(void 0===i||null!=i&&i.hasOwnProperty("__kwargtrans__"))i=null;return function(){if(e.anyinfo=!1,e.depthlimit=n,e.timelimit=i,e.analysisstartedat=(new Date).getTime(),e.bestmoveuci=null,e.analyzing.set(!0),null!==e.enginecommandcallback){var r=ze(t,200,e.getmultipv());e.enginecommandcallback(G({kind:"analyze",variantkey:e.basicboard.variantkey,multipv:r,fen:e.basicboard.fen,owner:e.id}))}}})},get stopanalyzecallback(){return a(this,function(e){e.analyzing.set(!1),e.basicboard.clearcanvases(),null!==e.enginecommandcallback&&e.enginecommandcallback(G({kind:"stopanalyze",owner:e.id}))})},get analysismoveclicked(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=!1;null!==e.moveclickedcallback&&(n&&e.storeanalysiscallback(),e.moveclickedcallback(e.basicboard.variantkey,e.basicboard.fen,t))})},get setenginebar(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=null;if(null===t)t=e.latestscore;if(e.latestscore=t,e.flip)t=-t;if(f(" b",e.basicboard.fen))t=-t;if(e.enginebardiv.x(),t<-e.enginebarrange)t=-e.enginebarrange;if(t>e.enginebarrange)t=e.enginebarrange;var n=(t+e.enginebarrange)/(2*e.enginebarrange)*e.totalheight();e.bardiv=Oe().pa().w(e.enginebardivwidth).h(n).t(e.totalheight()-n).l(0),e.bardiv.bc(fe(t)),e.enginebardiv.a(e.bardiv);for(var i=2*e.enginebarrange/100,r=1;r<i;r++){var a=r*e.totalheight()/i-1,o="#0f0";if(r==i/2)o="#fff";else if(r>i/2)o="#f00";e.enginebardiv.a(Oe().pa().t(a).l(0).w(e.enginebardivwidth).h(3).bc(o))}})},get getgamesan(){return a(this,function(e){try{var t=e.positioninfos[e.gamei],n=e.positioninfos[e.gamei+1],i=t.fen,r=n.positioninfo;return i!=e.basicboard.fen?null:r.genmove.san}catch(e){return null}})},get buildanalysisinfodiv(){return a(this,function(e){e.analysisinfodiv.x(),e.basicboard.clearcanvases(),e.maxdepth=0;var t=[];for(var n of e.analysisinfo.pvitems)try{(a=Pt(n)).bestmovesanclickedcallback=e.analysismoveclicked,a.bonussliderchangedcallback=e.buildanalysisinfodiv,a.depth>e.maxdepth&&(e.maxdepth=a.depth),t.append(a)}catch(e){}var i=e.getgamesan(),r=1;for(var a of ee(t,c({key:function(e){return e.effscore()},reverse:!0}))){a.i=r,a.build(i),1==r&&(e.bestmoveuci=a.bestmoveuci,e.setenginebar(a.effscore()));var o=1/(5*r);"off"==e.trainmode&&e.basicboard.drawuciarrow(a.bestmoveuci,G({strokecolor:fe(a.effscore()),linewidth:o,headheight:o})),e.analysisinfodiv.a(a),r++}})},get processanalysisinfo(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=!1;if(e.analyzing||n){e.anyinfo=!0;var i=(new Date).getTime()-e.analysisstartedat;if(e.analysisinfo=t,e.buildanalysisinfodiv(),e.analyzing.py_get()&&null!==e.depthlimit||null!==e.timelimit){var r=null===e.depthlimit||e.maxdepth>=e.depthlimit,a=null===e.timelimit||i>=e.timelimit;r&&a&&e.stopandstoreanalysis()}}})},get stopandstoreanalysis(){return a(this,function(e){e.stopanalyzecallback(),e.anyinfo&&e.storeanalysiscallback()})},get makeanalyzedmovecallback(){return a(this,function(e){null!==e.bestmoveuci&&null!==e.moveclickedcallback&&e.moveclickedcallback(e.basicboard.variantkey,e.basicboard.fen,e.bestmoveuci)})},get storeanalysiscallback(){return a(this,function(e){null!==e.analysisinfo?lt().sioreq(G({kind:"storedb",path:"analysisinfo/{}/{}".format(e.basicboard.variantkey,e.analysisinfo.zobristkeyhex),owner:e.id,dataobj:G({analysisinfo:e.analysisinfo})})):window.alert("No analysis to store.")})},get getmultipv(){return a(this,function(e){try{return _(e.multipvcombo.v())}catch(t){return e.defaultmultipv}})},get analyzingchangedcallback(){return a(this,function(e){e.analysiscontrolpanelbottom.bc(ze(e.analyzing.py_get(),"#afa","#edd"))})},get getconfigscalar(){return a(this,function(e,t,n){if(null===e.configschema)return n;var i=getscalarfromschema(e.configschema,t);return null===i?n:i})},get getconfigbool(){return a(this,function(e,t,n){var i=e.getconfigscalar(t,null);return null===i?n:"true"==i||"false"!=i&&n})},get getconfigint(){return a(this,function(e,t,n){var i=e.getconfigscalar(t,null);if(null===i)return n;try{return _(i)}catch(e){return n}})},get gamesloadedok(){return a(this,function(e,t){e.pgnlist=Ot(e).setcontent(t),e.gamesdiv.x(),e.gamesdiv.a(je("Reload",e.loadgames)),e.gamesdiv.a(e.gamesloadingdiv.x()),e.gamesdiv.a(e.pgnlist)})},get gameloaderr(){return a(this,function(e,t){ne("game load error",t)})},get loadgames(){return a(this,function(e){e.gamesloadingdiv.html("Games loading..."),null!==e.username&&e.dogames&&function(e,t,n,i,r){(void 0===r||null!=r&&r.hasOwnProperty("__kwargtrans__"))&&(r=null);var a={method:"GET"};null!==t&&(a.headers={Authorization:"Bearer {}".format(t)});var o="https://lichess.org/"+e;r&&r.html("<a href='{}' target='_blank' rel='noopener noreferrer'>{}</a>".format(o,o)),fetch(o,a).then(function(e){return e.text().then(function(e){return n(e)},function(e){return i(e)})},function(e){return i(e)})}("{}/{}?max={}{}".format("api/games/user",e.username,e.maxgames,e.gamesfilter),e.usertoken,e.gamesloadedok,e.gameloaderr,e.gamesshowlinkdiv)})},get setusername(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=null;return e.username=t,e.usertoken=n,e.loadgames(),e})},get setconfigschema(){return a(this,function(e,t){e.configschema=t,e.showfen=e.getconfigbool("global/showfen",!0),e.basicboard.showfen=e.showfen,e.resizetask()})},get storeforward(){return a(this,function(e){e.storeanalysiscallback(),e.gameforward()})},get storemake(){return a(this,function(e){e.storeanalysiscallback(),e.makeanalyzedmovecallback()})},get defaultmoveclickedcallback(){return a(this,function(e,t,n,i,r){if(void 0===r||null!=r&&r.hasOwnProperty("__kwargtrans__"))r=!0;if(r&&("white"==e.trainmode&&0==e.basicboard.turn()||"black"==e.trainmode&&1==e.basicboard.turn()))return e.examinealgeb=i,void e.trainhandler();lt().sioreq(G({kind:"mainboardmove",variantkey:t,fen:n,moveuci:i,owner:e.id}))})},get setvariantandfen(){return a(this,function(e,t,n){lt().sioreq(G({kind:"mainboardsetvariant",variantkey:t,fen:n,owner:e.id}))})},get defaultvariantchangedcallback(){return a(this,function(e,t,n){e.setvariantandfen(t,n)})},get defaultenginecommandcallback(){return a(this,function(e,t){t.owner=e.id,lt().sioreq(t)})},get createnewengine(){return a(this,function(e){lt().sioreq(G({kind:"createnewengine",owner:e.id}))})},get killengine(){return a(this,function(e){lt().sioreq(G({kind:"killengine",owner:e.id}))})},get addgamecontrolbuttons(){return a(this,function(e,t){t.a(je("#",e.gamehere).ac("analysiscontrol")),t.a(je("<<",e.gametobegin).ac("analysiscontrol")),t.a(je("<",e.gameback).ac("analysiscontrol").w(60)),t.a(je(">",e.gameforward).ac("analysiscontrol").w(60)),t.a(je(">>",e.gametoend).ac("analysiscontrol"))})},get doautoanalyis(){return a(this,function(e){e.autoanalysis&&(e.storeforward(),setTimeout(e.doautoanalyis,e.autoanalysisdelay))})},get autoanalysisclicked(){return a(this,function(e){e.autoanalysis=!e.autoanalysis,e.autoanalysisbutton.bc(ze(e.autoanalysis,"#afa","#ccc")),e.autoanalysis?(e.analyzecallbackfactory()(),setTimeout(e.doautoanalyis,e.autoanalysisdelay)):e.stopanalyzecallback()})},get multipvchanged(){return a(this,function(e,t){localStorage.setItem("mainboardmultipv",t)})},get lichessanalysisclicked(){return a(this,function(e){window.open("https://lichess.org/analysis/"+e.basicboard.variantkey+"/"+e.basicboard.fen,"_blank")})},get fentextchangedcallback(){return a(this,function(e,t){e.variantchanged(e.basicboard.variantkey,t)})},get gametabselected(){return a(this,function(e){try{e.posclickedfactory(e.gamei)()}catch(e){}})},get trainhandler(){return a(this,function(e){try{if(e.traintimediv.html((new Date).toLocaleString()),e.trainmode=e.traincombo.v(),"off"==e.trainmode)e.trainfen=null;else{var t=1;if("black"==e.trainmode)t=0;if(e.basicboard.turn()==t){if(e.trainfen==e.basicboard.fen);else if(e.analysisinfo&&e.positioninfo&&e.analysisinfo.zobristkeyhex==e.positioninfo.zobristkeyhex){var n=[];for(var i of e.analysisinfo.pvitems){try{var r=_(i.opptrainweight)}catch(e){r=0}r>0&&n.append([i.bestmoveuci,r])}if(h(n)>0){var a=[];for(var o of n)for(var s=0;s<o[1];s++)a.append(o[0]);if((l=_(Math.random()*h(a)))>=h(a))var l=h(a)-1;var c=a[l];e.trainfen=e.basicboard.fen,e.moveclickedcallback(e.basicboard.variantkey,e.basicboard.fen,c,!1)}}}else if(e.examinealgeb){var u=e.examinealgeb;if(e.examinealgeb=null,e.analysisinfo){var d=!1,f=0;for(var i of e.analysisinfo.pvitems)if(i.bestmoveuci==u){try{f=_(i.metrainweight)}catch(e){f=0}if(f>0){d=!0;break}}d?e.moveclickedcallback(e.basicboard.variantkey,e.basicboard.fen,u,!1):(setTimeout(function(){return window.alert("Wrong move.")},200),e.basicboard.setfromfen(e.basicboard.fen))}else setTimeout(function(){return window.alert("No analysis info available.")},200),e.basicboard.setfromfen(e.basicboard.fen)}}}catch(e){}})},get __init__(){return a(this,function(e,t){u(Et,"__init__")(e,"div"),e.addmovemode=!1,e.bookpath=null,e.resizeorigwidth=800,e.resizeorigheight=400,e.showfen=!0,e.flip=!1,"true"==localStorage.getItem("mainboardflip")&&(e.flip=!0),e.positioninfos=[],e.pgnlist=null,e.username=null,e.usertoken=null,e.configschema=null,e.depthlimit=null,e.analysisinfo=null,e.autoinfo=null,e.defaultmultipv=3;var n=localStorage.getItem("mainboardmultipv");n&&(e.defaultmultipv=n),e.bestmoveuci=null,e.analyzing=he(e.analyzingchangedcallback,!1),e.history=[],e.id=t.py_get("id","mainboard"),e.BARWIDTH=t.py_get("barwidth",20),e.RATINGHEIGHT=t.py_get("ratingheight",2),e.RATINGCLUSTER=t.py_get("ratingcluster",25),e.maxgames=t.py_get("maxgames",25),e.gamesfilter=t.py_get("gamesfilter",""),e.setposinfo=t.py_get("setposinfo",G({variantkey:"standard",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"})),e.dobook=t.py_get("dobook",!0),e.dostoredanalysis=t.py_get("dostoredanalysis",!0),e.dostoredauto=t.py_get("dostoredauto",!0),e.dogames=t.py_get("dogames",!0),e.dogamepreview=t.py_get("dogamepreview",!0),e.variantchangedcallback=t.py_get("variantchangedcallback",e.defaultvariantchangedcallback),e.moveclickedcallback=t.py_get("moveclickedcallback",e.defaultmoveclickedcallback),e.enginecommandcallback=t.py_get("enginecommandcallback",e.defaultenginecommandcallback),e.background="/static/img/backgrounds/"+t.py_get("background","wood.jpg"),e.autoanalysisdelay=1e3*t.py_get("autoanalysisdelay",10),t.movecallback=e.moveclickedcallback,t.fentextchangedcallback=e.fentextchangedcallback,e.basicboard=zt(t),e.controlpanel=Oe().ac("boardcontrolpanel"),e.controlpanelheight=pe("--boardcontrolpanelheight"),e.controlpanelwidth=260,e.controlpanel.a(je("Flip",e.flipcallback)),e.variantcombo=Ne(),e.setvariantcombo(),e.controlpanel.a(e.variantcombo).w(e.basicboard.outerwidth).mw(e.basicboard.outerwidth),e.controlpanel.a(je("Reset",e.setvariantcallback)),e.controlpanel.a(je("Clearall",e.clearcallback)),e.controlpanel.a(je("Delall",e.delallcallback)),e.controlpanel.a(je("Del",e.delcallback)),e.sectioncontainer=Oe().ac("bigboardsectioncontainer").w(e.basicboard.outerwidth),e.sectioncontainer.bci(e.background),e.sectioncontainer.a([e.controlpanel,e.basicboard]),e.verticalcontainer=Oe().ac("bigboardverticalcontainer"),e.movelistdivwidth=100,e.movelistdiv=Oe().ac("bigboardmovelist").w(e.movelistdivwidth).mw(e.movelistdivwidth),e.enginebardivwidth=15,e.enginebarrange=500,e.enginebardiv=Oe().pr().ac("bigboardenginebar").w(e.enginebardivwidth).mw(e.enginebardivwidth),e.analysisdiv=Oe(),e.autodiv=Oe(),e.analysiscontrolpaneltop=Oe().ac("bigboardanalysiscontrolpanel"),e.addgamecontrolbuttons(e.analysiscontrolpaneltop),e.analysiscontrolpaneltop.a(je("Store >",e.storeforward).ac("analysismake")),e.analysiscontrolpaneltop.a(je("Store Make",e.storemake).ac("analysismake")),e.analysiscontrolpaneltop.a(je("Store Stop",e.stopandstoreanalysis).ac("analysisstop")),e.analysiscontrolpanelbottom=Oe().ac("bigboardanalysiscontrolpanel"),e.analysiscontrolpanelbottom.a(je("#",e.getstoredanalysisinfo).ac("analysisanalyze")),e.analysiscontrolpanelbottom.a(je("Analyze",e.analyzecallbackfactory()).ac("analysisanalyze")),e.analysiscontrolpanelbottom.a(je("Analyze all",e.analyzecallbackfactory(!0)).ac("analysisanalyze")),e.analysiscontrolpanelbottom.a(je("Quick all",e.analyzecallbackfactory(!0,5,null)).ac("analysisanalyze")),e.analysiscontrolpanelbottom.a(je("Make",e.makeanalyzedmovecallback).ac("analysismake")),e.analysiscontrolpanelbottom.a(je("Stop",e.stopanalyzecallback).ac("analysisstop")),e.analysiscontrolpanelbottom.a(je("Store",e.storeanalysiscallback).ac("analysisstore")),e.autoanalysis=!1,e.autoanalysisbutton=je("A",e.autoanalysisclicked),e.analysiscontrolpanelbottom.a(e.autoanalysisbutton),e.lichessanalysisbutton=je("L",e.lichessanalysisclicked),e.analysiscontrolpanelbottom.a(e.lichessanalysisbutton);for(var i=[],r=1;r<501;r++)i.append([C(r),"MultiPV {}".format(r)]);e.multipvcombo=Ne(G({selectclass:"boardmultipvcomboselect",optionfirstclass:"boardmultipvcombooptionfirst",optionclass:"boardmultipvcombooption"})).setoptions(i,C(e.defaultmultipv),e.multipvchanged),e.analysiscontrolpanelbottom.a(e.multipvcombo),e.analysisdiv.a([e.analysiscontrolpaneltop,e.analysiscontrolpanelbottom]),e.analysisinfodiv=Oe(),e.analysisdiv.a(e.analysisinfodiv),e.gamescontainerdiv=Oe(),e.gamesshowlinkdiv=Oe().ms().pad(3),e.gamesloadingdiv=Oe(),e.gamesdiv=Oe(),e.gamescontainerdiv.a([e.gamesshowlinkdiv,e.gamesdiv]),e.gamediv=Oe(),e.pgntext=Tt(),e.engineoutpane=Ze(G({controlheight:40})),e.engineoutpane.controlpanel.a([je("Analyze",e.analyzecallbackfactory()),je("Stop",e.stopanalyzecallback),je("New engine",e.createnewengine),je("Kill engine",e.killengine)]),e.engineoutlog=at(),e.engineoutpane.setcontentelement(e.engineoutlog),e.bookpane=Ze(G({controlheight:40})),e.bookpathdiv=Oe("bookpathdiv"),e.addmovehook=Oe(),e.bookpane.controlpanel.a([e.bookpathdiv,e.addmovehook]),e.bookdiv=Oe().ms().fs(20),e.bookpane.setcontentelement(e.bookdiv),e.chartdiv=Oe(),e.traindiv=Oe().mar(3),e.traincombo=Ne().setoptions([["off","Training off"],["black","Train White"],["white","Train Black"]],"off"),e.traincontrols=Oe().disp("flex").jc("space-around").ai("center").h(40).w(400).bc("#eee"),e.traintimediv=Oe().w(200).bc("#eff").html("time").ff("monospace").ta("center"),e.traincontrols.a([e.traincombo,e.traintimediv]),e.traindiv.a(e.traincontrols),window.setInterval(e.trainhandler,500),e.tabpane=tt(G({kind:"normal",id:"board",tabs:[et("analysis","Analysis",e.analysisdiv),et("train","Train",e.traindiv),et("auto","Auto",e.autodiv),et("book","Book",e.bookpane),et("game","Game",e.gamediv,e.gametabselected),et("pgn","Pgn",e.pgntext),et("games","Games",e.gamescontainerdiv),et("chart","Chart",e.chartdiv),et("engineout","Engine out",e.engineoutpane)],selected:"analysis"})),e.verticalcontainer.a([e.sectioncontainer,e.enginebardiv,e.movelistdiv,e.tabpane]),e.a(e.verticalcontainer),e.basicresize(),e.variantchanged(e.setposinfo.variantkey,e.setposinfo.fen)})}}),It=null,Rt=[["kind","collection"],["disposition","dict"],["key",null],["value",""],["minvalue",0],["maxvalue",100],["valuestep",1],["selected",!1],["childsarg",[]],["childsopened",!1]],jt=function(e){return!!e&&"collection"==e.kind},Lt=l("Schema",[Se],{__module__:"schema",get copydivclicked(){return a(this,function(e){It=e.toargs()})},get openbuttonclicked(){return a(this,function(e){e.childsopened=!e.childsopened,e.build()})},get createcombochanged(){return a(this,function(e,t){if("scalar"==t)var n=Lt(G({parent:e,kind:"scalar",disposition:"string"}));else if("slider"==t)n=Lt(G({parent:e,kind:"scalar",disposition:"slider"}));else if("checkbox"==t)n=Lt(G({parent:e,kind:"scalar",disposition:"checkbox"}));else if("textarea"==t)n=Lt(G({parent:e,kind:"scalar",disposition:"textarea"}));else if("date"==t)n=Lt(G({parent:e,kind:"scalar",disposition:"date",value:(i=new Date,r=i.getUTCMonth()+1,a=i.getUTCDate(),o=i.getUTCFullYear(),"{}-{}-{}".format(o,me(r,2),me(a,2)))}));else if("color"==t)n=Lt(G({parent:e,kind:"scalar",disposition:"color",value:"#ffffff"}));else if("dict"==t)n=Lt(G({parent:e,kind:"collection",disposition:"dict"}));else if("list"==t)n=Lt(G({parent:e,kind:"collection",disposition:"list"}));else if("combo"==t)n=Lt(G({parent:e,kind:"collection",disposition:"combo"}));else if("radio"==t)n=Lt(G({parent:e,kind:"collection",disposition:"radio"}));else if("process"==t)n=Lt(G({parent:e,kind:"collection",disposition:"dict",childsopened:!0,childsarg:[G({kind:"scalar",disposition:"string",key:"key"}),G({kind:"scalar",disposition:"string",key:"displayname"}),G({kind:"scalar",disposition:"string",key:"command"}),G({kind:"collection",disposition:"list",key:"command_args"})]}));var i,r,a,o;e.childs.append(n),e.build()})},get stringvalueinputchanged(){return a(this,function(e){e.value=e.stringvalueinput.getText()})},get keyinputchanged(){return a(this,function(e){e.key=e.keyinput.getText()})},get deletechild(){return a(this,function(e,t){var n=[];for(var i of e.childs)i!=t?n.append(i):It=t.toargs();e.childs=n,e.build()})},get deletedivclicked(){return a(this,function(e){e.parent.deletechild(e)})},get pastebuttonpushed(){return a(this,function(e){if(It){It.parent=e;var t=Lt(It);e.childs.append(t),e.build()}})},get setslidervalue(){return a(this,function(e,t,n){if(void 0===n||null!=n&&n.hasOwnProperty("__kwargtrans__"))n=!0;e.value=g(t),e.value<e.minvalue&&(e.value=e.minvalue),e.value>e.maxvalue&&(e.value=e.maxvalue),n&&e.slider.sv(e.value),e.slidervalueinput.setText("{}".format(e.value))})},get minvalueinputchanged(){return a(this,function(e){e.minvalue=ve(e.minvalueinput.getText(),e.minvalue),e.slider.setmin(e.minvalue),e.setslidervalue(e.value)})},get maxvalueinputchanged(){return a(this,function(e){e.maxvalue=ve(e.maxvalueinput.getText(),e.maxvalue),e.slider.setmax(e.maxvalue),e.setslidervalue(e.value)})},get sliderstepinputhchanged(){return a(this,function(e){e.valuestep=ve(e.sliderstepinput.getText(),e.valuestep),e.slider.setstep(e.valuestep),e.setslidervalue(e.value)})},get sliderchanged(){return a(this,function(e){e.setslidervalue(e.slider.v(),!1)})},get slidervalueinputchanged(){return a(this,function(e){e.setslidervalue(ve(e.slidervalueinput.getText(),e.value))})},get checkboxchanged(){return a(this,function(e){e.value=e.checkbox.getchecked()})},get combocheckboxchanged(){return a(this,function(e){e.selected=e.combocheckbox.getchecked()})},get radioradioclicked(){return a(this,function(e){for(var t of e.parent.childs){var n=t==e;t.radioradio.setchecked(n),t.selected=n,ne(n)}})},get textareachanged(){return a(this,function(e){e.value=e.textarea.getText()})},get setdatelabel(){return a(this,function(e){var t,n,i,r,a;e.datelabel.html("{}".format((t=e.value,n=t.py_split("-"),i=parseInt(n[0]),r=parseInt(n[1])-1,a=parseInt(n[2]),new Date(i,r,a)).getTime()))})},get datechanged(){return a(this,function(e){e.value=e.date.v(),e.setdatelabel()})},get colorchanged(){return a(this,function(e){e.value=e.color.v(),e.colorlabel.html(e.value)})},get build(){return a(this,function(e){var t;if(e.x().ac("schema"),e.itemdiv=Oe(["item",e.disposition]),e.valuediv=Oe(["value",e.disposition]),"scalar"==e.kind&&("dict"==e.disposition&&(v(e.value)==m?e.disposition="checkbox":e.disposition="string"),"string"==e.disposition?(e.stringvalueinput=Me().ac("string").setText(e.value),e.stringvalueinput.ae("keyup",e.stringvalueinputchanged),e.valuediv.a(e.stringvalueinput)):"slider"==e.disposition?(e.slidervalueinput=Me().ac("slidervalue").setText(e.value).setchangecallback(e.slidervalueinputchanged),e.minvalueinput=Me().ac("sliderminmax").setText(e.minvalue).setchangecallback(e.minvalueinputchanged),e.slider=Ue().ac("sliderslider").ae("change",e.sliderchanged),e.maxvalueinput=Me().ac("sliderminmax").setText(e.maxvalue).setchangecallback(e.maxvalueinputchanged),e.sliderstepinput=Me().ac("sliderstep").setText(e.valuestep).setchangecallback(e.sliderstepinputhchanged),e.valuediv.a([e.slidervalueinput,e.minvalueinput,e.slider,e.maxvalueinput,e.sliderstepinput]),e.slider.setmin(e.minvalue).setmax(e.maxvalue).setstep(e.valuestep),e.setslidervalue(ve(e.value,0))):"checkbox"==e.disposition?(e.value=!0===e.value,e.checkbox=Be().ac("checkbox").setchecked(e.value).ae("change",e.checkboxchanged),e.valuediv.a(e.checkbox)):"textarea"==e.disposition?(e.textarea=Ke().ac("textarea").setText(e.value),e.textarea.ae(["keyup","change"],e.textareachanged),e.valuediv.a(e.textarea)):"date"==e.disposition?(e.date=Fe().ac("date").sv(e.value),e.date.ae(["keyup","change"],e.datechanged),e.datelabel=Je().ac("datelabel"),e.setdatelabel(),e.valuediv.a([e.date,e.datelabel])):"color"==e.disposition&&(e.color=We().ac("color").sv(e.value),e.color.ae(["keyup","change"],e.colorchanged),e.colorlabel=Je().ac("colorlabel").html(e.value),e.valuediv.a([e.color,e.colorlabel]))),e.helpdiv=Oe(["box","help"]).html("?"),e.copydiv=Oe(["box","copy"]).html("C").ae("mousedown",e.copydivclicked),t=e.parent,jt(t)&&"dict"==t.disposition&&(e.keydiv=Oe("key"),e.keyinput=Me().ac("key").setText(e.key),e.keyinput.ae("keyup",e.keyinputchanged),e.keydiv.a(e.keyinput),e.itemdiv.a(e.keydiv)),function(e){return!!jt(e)&&"combo"==e.disposition}(e.parent)&&(e.combodiv=Oe(["box","combo"]),e.combocheckbox=Be().ac("checkbox").setchecked(e.selected).ae("change",e.combocheckboxchanged),e.combodiv.a(e.combocheckbox),e.itemdiv.a(e.combodiv)),function(e){return!!jt(e)&&"radio"==e.disposition}(e.parent)&&(e.radiodiv=Oe(["box","radio"]),e.radioradio=He().ac("radio").setchecked(e.selected).ae("mousedown",e.radioradioclicked),e.radiodiv.a(e.radioradio),e.itemdiv.a(e.radiodiv)),e.itemdiv.a([e.valuediv,e.helpdiv,e.copydiv]),e.parent&&(e.deletediv=Oe(["box","delete"]).html("X").ae("mousedown",e.deletedivclicked),e.itemdiv.a(e.deletediv)),jt(e)&&(e.openbutton=Oe("openbutton").ae("mousedown",e.openbuttonclicked),e.valuediv.a(e.openbutton)),e.childsdiv=Oe("childs"),e.childsopened){e.creatediv=Oe("create");e.createcombo;for(var n of(e.createcombo=Ne().setoptions([["create","Create new"],["scalar","Scalar"],["slider","Slider"],["checkbox","Checkbox"],["textarea","Textarea"],["date","Date"],["color","Color"],["dict","Dict"],["list","List"],["combo","Combo"],["radio","Radio"],["process","Process"]],"create",e.createcombochanged).ac("createcombo"),e.creatediv.a(e.createcombo),e.pastebutton=je("Paste",e.pastebuttonpushed).ac("pastebutton"),e.creatediv.a(e.pastebutton),e.childsdiv.a(e.creatediv),e.childs))e.childsdiv.a(n)}return e.container=Oe("container"),e.container.a([e.itemdiv,e.childsdiv]),e.a(e.container),e})},get tojsontext(){return a(this,function(e){return JSON.stringify(e.toargs(),null,2)})},get toargs(){return a(this,function(e){var t=G({});for(var n of Rt)t[n[0]]=e[n[0]];for(var i of(t.childsarg=[],e.childs))t.childsarg.append(i.toargs());return t})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});for(var n of(u(Lt,"__init__")(e,"div"),e.parent=xe(t,"parent",null),Rt))e[n[0]]=xe(t,n[0],n[1]);for(var i of(e.childs=[],e.childsarg)){i.parent=e;var r=Lt(i);e.childs.append(r)}e.build()})},get getchildbykey(){return a(this,function(e,t){for(var n of e.childs)if(n.key==t)return n;return null})},get getpathrec(){return a(this,function(e,t,n){if(!t)return null;if(0==h(n))return t;var i=n[0];n=n.__getslice__(1,null,1);return"dict"==e.disposition?e.getpathrec(e.getchildbykey(i),n):null})},get getpath(){return a(this,function(e,t){if(""==t)var n=[];else n=t.py_split("/");return e.getpathrec(e,n)})}}),Dt=[["name","filename"],["st_size","size"],["isdir","isdir"],["st_mtime","mtime"],["st_mode_unix_rwx","rwx"]],Nt=l("DirItem",[Se],{__module__:"system",get __init__(){return a(this,function(e,t){for(var n of(u(Nt,"__init__")(e,"div"),e.container=Oe("diritem"),Dt)){e[n[1]]=t[n[0]];var i=Oe(n[1]);e[n[1]+"div"]=i,e.container.a(i)}e.isdir&&e.container.ac("isdir"),e.filenamelabel=Oe().html(e.filename),e.filenamediv.a([e.filenamelabel]),e.deletebutton=null,".."==e.filename?e.filenamediv.ac("parent"):(e.deletebutton=je("Delete").ac("delete"),e.isdirdiv.a(e.deletebutton),e.mtimediv.html(new Date(1e3*e.mtime).toLocaleString())),e.isdir?e.sizediv.html("dir"):(e.editbutton=je("Edit"),e.filenamediv.a(e.editbutton),e.sizediv.html(e.size)),e.rwx&&e.rwxdiv.html(e.rwx),e.a(e.container)})}}),Ut=l("EditTextarea",[Se],{__module__:"system",get resize(){return a(this,function(e,t,n){e.textarea.w(t-9).h(n-9)})},get setText(){return a(this,function(e,t){return e.textarea.setText(t),e})},get getText(){return a(this,function(e){return e.textarea.getText()})},get __init__(){return a(this,function(e){u(Ut,"__init__")(e,"div"),e.textarea=Ke(),e.a(e.textarea)})}}),Bt=l("Editor",[Se],{__module__:"system",get setpath(){return a(this,function(e,t){e.path=t,e.pathlabel.html(e.path)})},get resize(){return a(this,function(e,t,n){e.editdiv.resize(t,n)})},get setText(){return a(this,function(e,t){return e.edittextarea.setText(t),e})},get getText(){return a(this,function(e){return e.edittextarea.getText()})},get __init__(){return a(this,function(e){u(Bt,"__init__")(e,"div"),e.editdiv=Ze(G({controlheight:40})),e.pathlabel=Oe("pathlabel"),e.editdiv.controlpanel.a(e.pathlabel),e.reloadbutton=je("Reload"),e.savebutton=je("Save"),e.editdiv.controlpanel.a([e.reloadbutton,e.savebutton]),e.edittextarea=Ut(),e.editdiv.setcontentelement(e.edittextarea),e.a(e.editdiv)})}}),Ht=l("DirBrowser",[Se],{__module__:"system",get path(){return a(this,function(e){return 0==h(e.pathlist)?".":"/".join(e.pathlist)})},get dirclickedfactory(){return a(this,function(e,t){return function(){".."==t?(h(e.pathlist)>0&&e.pathlist.py_pop(),e.requestdirlist()):(e.pathlist.append(t),lt().sioreq(G({kind:"appenddirtopath",owner:e.id,drive:e.drive,dirpath:e.path(),dir:t})),e.pathlist.py_pop())}})},get openclickedfactory(){return a(this,function(e,t){return function(){e.drive?window.open("/file/drive/"+lt().getuid()+"/"+e.comppath(t)):window.open("/file/"+e.comppath(t))}})},get editclickedfactory(){return a(this,function(e,t){return function(n){n.stopPropagation(),e.editclickedcallback&&e.editclickedcallback(t)||e.requestpath(e.comppath(t))}})},get deletefileclickedfactory(){return a(this,function(e,t){return function(n){window.confirm("Delete file [ "+t+" ] ?")&&e.requestdeletefile(t)}})},get deletedirclickedfactory(){return a(this,function(e,t){return function(n){window.confirm("Delete directory [ "+t+" ] ?")&&e.requestdeletedir(t)}})},get appenditem(){return a(this,function(e,t){var n=Nt(t);e.filescontentdiv.a(n),t.isdir?(n.filenamediv.ae("mousedown",e.dirclickedfactory(t.name)),n.deletebutton&&n.deletebutton.ae("mousedown",e.deletedirclickedfactory(t.name))):(n.filenamediv.ae("mousedown",e.openclickedfactory(t.name)),n.editbutton.ae("mousedown",e.editclickedfactory(t.name)),n.deletebutton.ae("mousedown",e.deletefileclickedfactory(t.name)))})},get build(){return a(this,function(e){var t=[],n=[];for(var i of(e.listing=ee(e.listing,c({key:function(e){return e.name.toLowerCase()}})),e.listing))i.isdir?t.append(i):n.append(i);for(var i of(e.listing=[],t))e.listing.append(i);for(var i of n)e.listing.append(i);for(var i of(e.pathlabel.html(e.path()),e.filescontentdiv.x(),h(e.pathlist)>0&&e.appenditem(G({name:"..",isdir:!0})),e.listing))e.appenditem(i)})},get siores(){return a(this,function(e,t){if(f("kind",t)){var n=t.kind;"setdirlist"==n?(e.listing=t.listing,e.build()):"pathcontent"==n?(e.editor.setpath(t.path),e.editor.setText(t.content),e.tabs.selectbykey("edit")):"appenddirtopath"==n?(e.pathlist.append(t.dir),e.requestdirlist()):"appenddirtopathfailed"==n?window.alert("Opening directory failed. Status: {} .".format(t.status)):"getdirlistfailed"==n?window.alert("Get dirlist failed. Status: {} .".format(t.status)):"getpathfailed"==n?window.alert("Get path failed. Status: {} .".format(t.status)):"createfilefailed"==n?window.alert("Create file failed. Status: {} .".format(t.status)):"createdirfailed"==n?window.alert("Create directory failed. Status: {} .".format(t.status)):"deletefilefailed"==n?window.alert("Delete file failed. Status: {} .".format(t.status)):"deletedirfailed"==n?window.alert("Delete directory failed. Status: {} .".format(t.status)):"savefilefailed"==n&&window.alert("Save file failed. Status: {} .".format(t.status))}})},get comppath(){return a(this,function(e,t){return"."==e.path()?t:e.path()+"/"+t})},get requestdirlist(){return a(this,function(e){lt().sioreq(G({kind:"getdirlist",owner:e.id,drive:e.drive,dirpath:e.path()}))})},get requestpath(){return a(this,function(e,t){lt().sioreq(G({kind:"getpath",owner:e.id,drive:e.drive,path:t}))})},get requestcreatefile(){return a(this,function(e,t){lt().sioreq(G({kind:"createfile",owner:e.id,drive:e.drive,path:e.comppath(t),dirpath:e.path()}))})},get requestcreatedir(){return a(this,function(e,t){lt().sioreq(G({kind:"createdir",owner:e.id,drive:e.drive,path:e.comppath(t),dirpath:e.path()}))})},get requestdeletefile(){return a(this,function(e,t){lt().sioreq(G({kind:"deletefile",owner:e.id,drive:e.drive,path:e.comppath(t),dirpath:e.path()}))})},get requestdeletedir(){return a(this,function(e,t){lt().sioreq(G({kind:"deletedir",owner:e.id,drive:e.drive,path:e.comppath(t),dirpath:e.path()}))})},get requestsave(){return a(this,function(e,t,n){lt().sioreq(G({kind:"savefile",owner:e.id,drive:e.drive,content:n,path:t}))})},get requestziptocloud(){return a(this,function(e){lt().sioreq(G({kind:"ziptocloud",owner:e.id,drive:e.drive}))})},get requestunzipfromcloud(){return a(this,function(e){lt().sioreq(G({kind:"unzipfromcloud",owner:e.id,drive:e.drive}))})},get resize(){return a(this,function(e,t,n){e.tabs.resize(t,n),e.build()})},get reloadclicked(){return a(this,function(e){e.requestpath(e.editor.path)})},get saveclicked(){return a(this,function(e){e.requestsave(e.editor.path,e.editor.getText())})},get createfileclicked(){return a(this,function(e){var t=window.prompt("Enter file name","foo.txt");t&&""!=t&&e.requestcreatefile(t)})},get createdirclicked(){return a(this,function(e){var t=window.prompt("Enter directory name","foo");t&&""!=t&&e.requestcreatedir(t)})},get refreshclicked(){return a(this,function(e){e.requestdirlist()})},get ziptocloudclicked(){return a(this,function(e){e.requestziptocloud()})},get unzipfromcloudclicked(){return a(this,function(e){e.requestunzipfromcloud()})},get dirbrowseruploadedcallback(){return a(this,function(e){e.tabs.selectbykey("files"),e.requestdirlist()})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(Ht,"__init__")(e,"div"),e.ac("dirbrowser"),e.id=t.py_get("id",null),e.drive=t.py_get("drive",!1),e.editclickedcallback=t.py_get("editclickedcallback",null),e.pathlist=[],e.listing=[],e.filesdiv=Ze(G({controlheight:40})),e.pathlabel=Oe("pathlabel"),e.createfilebutton=je("Create file",e.createfileclicked),e.createdirbutton=je("Create dir",e.createdirclicked),e.refreshbutton=je("Refresh",e.refreshclicked),e.filesdiv.controlpanel.a([e.pathlabel,e.createfilebutton,e.createdirbutton,e.refreshbutton]),e.drive&&(e.ziptocloudbutton=je("Zip to cloud",e.ziptocloudclicked),e.unzipfromcloudbutton=je("Unzip from cloud",e.unzipfromcloudclicked),e.filesdiv.controlpanel.a([e.ziptocloudbutton,e.unzipfromcloudbutton])),e.filescontentdiv=Oe(),e.filesdiv.setcontentelement(e.filescontentdiv),e.editor=Bt(),e.editor.reloadbutton.ae("mousedown",e.reloadclicked),e.editor.savebutton.ae("mousedown",e.saveclicked),e.uploader=nt(G({url:"/dirbrowserupload",accept:"*",acceptdisplay:"file",drive:e.drive,dirbrowseruploadedcallback:e.dirbrowseruploadedcallback,dirbrowsergetpathcallback:e.path,getuid:lt().getuid})),e.tabs=tt(G({id:e.id+"tabpane",tabs:[et("files","Files",e.filesdiv),et("edit","Edit",e.editor),et("upload","Upload",e.uploader)],selected:"files"})),e.tabs.controlpanel.ac("subcontrolpanel"),e.a(e.tabs),e.requestdirlist()})}}),Ft=l("ProcessConsole",[Ze],{__module__:"system",get shortcutclickedfactory(){return a(this,function(e,t){return function(){e.sendline(t)}})},get procout(){return a(this,function(e,t){var n=t.subkind,i=t.notify;ne("subkind",n,i);var r="normal",a="<proc>";if("linesent"==n)r="info",a=t.sline;else if("procstderr"==n)r="error",a=t.sline;else if("procstdout"==n)a=t.sline;else if(i){a=i,r="success";if("!"==i.__getslice__(0,1,1))r="error"}e.log.log(rt(G({prompt:"{} &gt; ".format(t.key),text:a,kind:r})))})},get sendline(){return a(this,function(e,t){lt().sioreq(G({kind:"sendline",key:e.key,command:e.command,command_args:e.command_args,sline:t}))})},get onenter(){return a(this,function(e){var t=e.processinput.getText();e.processinput.setText(""),e.sendline(t)})},get startcallback(){return a(this,function(e){lt().sioreq(G({kind:"startprocess",key:e.key,command:e.command,command_args:e.command_args}))})},get stopcallback(){return a(this,function(e){lt().sioreq(G({kind:"stopprocess",key:e.key}))})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});for(var n of(u(Ft,"__init__")(e,t),e.ac("processconsole"),e.key=t.py_get("key",null),e.command=t.py_get("command",null),e.command_args=t.py_get("command_args",[]),e.processinput=it(G({buttonlabel:t.py_get("buttonlabel","Submit"),entercallback:t.py_get("entercallback",e.onenter)})),e.processinput.submitbutton.ac("bluebutton"),e.startbutton=je("Start",e.startcallback).ac("greenbutton"),e.stopbutton=je("Stop",e.stopcallback).ac("redbutton"),e.controlpanel.a([e.processinput,e.startbutton,e.stopbutton]),e.shortcuts=t.py_get("shortcuts",[]),e.shortcuts))e.controlpanel.a(je(n[0],e.shortcutclickedfactory(n[1])));e.log=at(),e.setcontentelement(e.log)})}}),Wt=l("Doc",[Se],{__module__:"system",get siores(){return a(this,function(e,t){"showdoc"==t.kind&&e.setdoc(t)})},get reflinkclickedfactory(){return a(this,function(e,t){return function(){lt().sioreq(G({kind:"getdoc",owner:e.id,data:t}))}})},get setdoc(){return a(this,function(e,t){var n=t.doc,i="### $!contents$$-> back to Table of contents!$\n";if("contents"!=t.docref&&e.showcontentslink)n=i+n+i;var r=(p=e.mdconv.makeHtml(n)).py_split("$!"),a=[r[0]];for(var o of r.__getslice__(1,null,1)){var s=o.py_split("!$"),l=s[0].py_split("$$"),c=l[0],u=l[1],d=s[1],f="<span purpose='reflink' class='docref noselect' docref='{}'>{}</span>".format(c,u);a.append(f),a.append(d)}var p="".join(a);for(var h of(e.docdiv.html(p),e.srcdiv.html(ye(p)),be(e.docdiv.e)))try{var g=h.getAttribute("purpose");c=h.getAttribute("docref");"reflink"==g&&h.addEventListener("mousedown",e.reflinkclickedfactory(c))}catch(e){}})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(Wt,"__init__")(e,"div"),e.id=t.py_get("id","doc"),e.startpage=t.py_get("startpage","contents"),e.showcontentslink=t.py_get("showcontentslink",!0),e.mdconv=new showdown.Converter,e.docdiv=Oe("docdiv"),e.srcdiv=Oe("srcdiv"),e.a(e.docdiv),lt().sioreq(G({kind:"getdoc",owner:e.id,data:e.startpage,switchtodoctab:!1}))})}}),Mt=l("ProcessPane",[Se],{__module__:"system",get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(Mt,"__init__")(e,"div"),e.processconsoles=G({}),e.configsch=t.py_get("configsch",G({})),e.id=t.py_get("id","processpane");try{e.build()}catch(t){ne("processpane {} build failed from {}".format(e.id,e.configsch))}})},get resize(){return a(this,function(e,t,n){e.processtabpane&&e.processtabpane.resize(t,n)})},get siores(){return a(this,function(e,t){var n=t.key;f(n,e.processconsoles)&&e.processconsoles[n].procout(t)})},get build(){return a(this,function(e){var t=[],n=null;for(var i of e.configsch.childs){var r=i.getpath("key").value,a=i.getpath("command").value,o=[];for(var s of i.getpath("command_args").childs)o.append(s.value);if(!n)n=r;var l=i.getpath("displayname").value,c=[],u=i.getpath("shortcuts");if(u)for(var d of u.childs)c.append([d.key,d.value]);var f=Ft(G({key:r,command:a,command_args:o,shortcuts:c}));e.processconsoles[r]=f,t.append(et(r,l,f))}return e.processtabpane=tt(G({id:e.id,tabs:t,selected:n})),e.x().a(e.processtabpane),e})}}),Gt=l("Config",[Se],{__module__:"system",get serializeconfig(){return a(this,function(e){lt().sioreq(G({kind:"serializeconfig",data:e.configschema.toargs(),owner:e.id}))})},get resize(){return a(this,function(e,t,n){e.configsplitpane.resize(t,n)})},get build(){return a(this,function(e){e.configsplitpane=Ze(G({controlheight:50})),e.configdiv=Oe("largesheet"),e.configsplitpane.controlpanel.a(je("Serialize",e.serializeconfig).ac("controlbutton")),e.configsplitpane.controlpanel.ac("subcontrolpanel"),e.configschema=Lt(e.schemaconfig),e.configdiv.a(e.configschema),e.configsplitpane.setcontentelement(e.configdiv),e.x().a(e.configsplitpane)})},get setschemaconfig(){return a(this,function(e,t){e.schemaconfig=t,e.build()})},get py_get(){return a(this,function(e,t,n){return we(t,e.configschema,n)})},get getpath(){return a(this,function(e,t){return e.configschema.getpath(t)})},get __init__(){return a(this,function(e,t){if(void 0===t||null!=t&&t.hasOwnProperty("__kwargtrans__"))t=G({});u(Gt,"__init__")(e,"div"),e.id=t.py_get("id","config"),e.schemaconfig=G({kind:"collection",disposition:"dict"}),e.build()})}});l("Client",[s],{__module__:"client",get __init__(){return a(this,function(e){e.isadmin=!1,e.root=qe("clientroot"),e.owners=G({}),e.config=Gt(),e.authdone=!1,e.connectdone=!1})},get driveeditclickedcallback(){return a(this,function(e,t){if("bin"==function(e){var t=e.py_split(".");return t[h(t)-1]}(t))return e.mainboard.setbookpath(t,!0),e.mainboard.tabpane.selectbykey("book"),e.tabs.selectbykey("board"),e.mainboard.getbookpage(),!0})},get requestbots(){return a(this,function(e){lt().sioreq(G({kind:"getmybots"}))})},get createbotdiv(){return a(this,function(e){e.botdiv=Oe(),e.botresultdiv=Oe(),e.botdiv.a(je("Request bots",e.requestbots).mar(10)),e.botdiv.a(Xe("/bots","Bots page")),e.botdiv.a(e.botresultdiv)})},get build(){return a(this,function(e){e.root.innerHTML="",e.owners.config=e.config,e.dodirbrowser?(e.maindirbrowser=Ht(G({id:"maindirbrowser"})),e.owners.maindirbrowser=e.maindirbrowser):e.maindirbrowser=Oe(),e.dodrive?(e.drive=Ht(G({id:"drive",drive:!0,editclickedcallback:e.driveeditclickedcallback})),e.owners.drive=e.drive):e.drive=Oe(),e.createbotdiv(),e.doboard?(e.mainboard=Et(G({dobook:e.dobook,dostoredanalysis:e.dostoredanalysis,dostoredauto:e.dostoredauto,dogames:e.dogames,setposinfo:e.setposinfo,dogamepreview:e.dogamepreview,background:e.boardbackground,autoanalysisdelay:e.autoanalysisdelay,maxgames:e.maxgames,gamesfilter:e.gamesfilter})),e.mainboard.setusername(e.username,e.usertoken),e.mainboard.tabpane.controlpanel.ac("subcontrolpanel"),e.owners.mainboard=e.mainboard):e.mainboard=Oe(),e.dodocs?(e.doc=Wt(),e.srcdiv=e.doc.srcdiv,e.owners.doc=e.doc):(e.doc=Oe(),e.srcdiv=Oe()),e.doabout?(e.about=Wt(G({id:"about",startpage:"about",showcontentslink:!1})),e.owners.about=e.about):e.about=Oe(),e.isadmin?(e.processpane=Mt(G({configsch:e.config.getpath("processes")})),e.processpane.processtabpane.controlpanel.ac("subcontrolpanel")):e.processpane=Oe("featureplaceholder").html("Admin only feature."),e.forumgametab=et("forumgame","Forum game",Oe("featureplaceholder").html("Forum game disabled.")),e.doforumgame&&(e.forumgame=Ct(),e.forumgame.mainboard=e.mainboard,e.owners.forumgame=e.forumgame,e.forumgametab=et("forumgame","Forum game",e.forumgame)),e.tabs=tt(G({id:"maintabpane",fillwindow:!0,tabs:[et("config","Config",e.config),et("upload","Upload",nt(G({url:"/upload"}))),et("board","Board",e.mainboard),e.forumgametab,et("process","Process",e.processpane),et("dirbrowser","Dirbrowser",e.maindirbrowser),et("drive","Drive",e.drive),et("bots","Bots",e.botdiv),et("doc","Doc",e.doc),et("src","Src",e.srcdiv),et("log","Log",lt().log),lt().profiletab,et("about","About",e.about)],selected:"drive"})),e.root.appendChild(e.tabs.e);var t=ae.py_get("tab",null);t&&e.tabs.selectbykey(t)})},get onready(){return a(this,function(e){lt().sioreq(G({kind:"connected",queryparams:ae}))})},get setloadinfo(){return a(this,function(e,t){qe("connectmsg").innerHTML=t})},get onconnect(){return a(this,function(e){e.connectdone=!0,e.authdone?e.onready():e.setloadinfo("Authenticating, please wait ...")})},get onauth(){return a(this,function(e){e.authdone=!0,e.connectdone?e.onready():e.setloadinfo("Authenticated, connecting to server, please wait ...")})},get getschemaconfigfromobj(){return a(this,function(e,t){e.config.setschemaconfig(t.schemaconfig),e.dodocs=e.config.py_get("global/dodocs",!0),e.dobook=e.config.py_get("global/dobook",!0),e.username=e.config.py_get("global/username"),e.usertoken=e.config.py_get("global/usertoken"),e.dostoredanalysis=e.config.py_get("global/dostoredanalysis",!0),e.dodirbrowser=e.config.py_get("global/dodirbrowser",!0),e.dodrive=e.config.py_get("global/dodrive",!0),e.dogames=e.config.py_get("global/dogames",!0),e.doboard=e.config.py_get("global/doboard",!0),e.doabout=e.config.py_get("global/doabout",!0),e.dogamepreview=e.config.py_get("global/dogamepreview",!0),e.doforumgame=e.config.py_get("global/doforumgame",!0),e.dostoredauto=e.config.py_get("global/dostoredauto",!0),e.boardbackground=e.config.py_get("layout/boardbackground","wood.jpg"),e.autoanalysisdelay=e.config.py_get("global/autoanalysisdelay",!0),e.maxgames=e.config.py_get("global/maxgames",25),e.gamesfilter=e.config.py_get("global/gamesfilter",""),e.setposinfo=t.setposinfo})},get buildfromconfiginobj(){return a(this,function(e,t){e.getschemaconfigfromobj(t),e.build()})},get setmybots(){return a(this,function(e,t){var n=t.mybots;for(var i in e.botresultdiv.x(),n){var r=n[i];e.botresultdiv.a(Oe().html("{} {}".format(r.username,ze(r.online,"online","offline"))).fs(25).pad(5)),e.botresultdiv.a(Oe().html("follow {} games {} last move {}".format(r.nbFollowers,r.count.all,r.lastmoveago)).fs(20).pad(3)),e.botresultdiv.a(Oe().html("last players {}".format(r.lastplayers)).fs(20).pad(3))}})},get siores(){return a(this,function(e,t){if(e.isadmin=t.isadmin,"true"==ae.py_get("noadmin","false")&&(e.isadmin=!1),f("kind",t)){var n=t.kind;if("buffered"==n)for(var i of t.items)e.siores(i);else if("connectedack"==n)e.buildfromconfiginobj(t);else if("configsaved"==n)window.alert("Config saved, {} characters".format(t.size)),location.reload();else if("alert"==n)window.alert(t.data),t.reload&&location.reload();else if("proc"==n)e.processpane.siores(t);else if("storedb"==n);else if("storedbfailed"==n);else if("retrievedbfailed"==n);else if("mybots"==n)e.setmybots(t);else if(re())e.owners[t.owner].siores(t);else try{e.owners[t.owner].siores(t)}catch(e){ne("could not handle",t)}"showdoc"==n&&t.switchtodoctab&&e.tabs.selectbykey("doc")}})},get authtimeout(){return a(this,function(e){e.authdone||(ne("authtimeout"),e.onauth())})},get startup(){return a(this,function(e){var t;t=G({connectcallback:e.onconnect,authcallback:e.onauth,siorescallback:e.siores}),st=ot(t),re()&&setTimeout(e.authtimeout,3e3)})}})().startup()}]);